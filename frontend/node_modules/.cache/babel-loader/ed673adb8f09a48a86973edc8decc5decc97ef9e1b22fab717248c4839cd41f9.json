{"ast":null,"code":"import { __values, __spreadArray, __read, __assign } from '../../ext/tslib/tslib.es6.js';\nimport { createCache, rebuild, buildNodeWithSN, NodeType } from '../../../rrweb-snapshot/es/rrweb-snapshot.js';\nimport * as mitt_es from '../../../../ext/mitt/dist/mitt.es.js';\nimport mitt$1 from '../../../../ext/mitt/dist/mitt.es.js';\nimport { polyfill } from './smoothscroll.js';\nimport { Timer } from './timer.js';\nimport { createPlayerService, createSpeedService } from './machine.js';\nimport { ReplayerEvents, EventType, IncrementalSource, MouseInteractions } from '../types.js';\nimport { polyfill as polyfill$1, isIframeINode, hasShadowRoot, queueToResolveTrees, iterateResolveTree, getBaseDimension, createMirror, TreeIndex } from '../utils.js';\nimport rules from './styles/inject-style.js';\nimport { getNestedRule, StyleRuleType, getPositionsAndIndex, storeCSSRules, applyVirtualStyleRulesToNode } from './virtual-styles.js';\nimport canvasMutation from './canvas/index.js';\nvar SKIP_TIME_THRESHOLD = 10 * 1000;\nvar SKIP_TIME_INTERVAL = 5 * 1000;\nvar mitt = mitt$1 || mitt_es;\nvar REPLAY_CONSOLE_PREFIX = '[replayer]';\nvar defaultMouseTailConfig = {\n  duration: 500,\n  lineCap: 'round',\n  lineWidth: 3,\n  strokeStyle: 'red'\n};\nfunction indicatesTouchDevice(e) {\n  return e.type == EventType.IncrementalSnapshot && (e.data.source == IncrementalSource.TouchMove || e.data.source == IncrementalSource.MouseInteraction && e.data.type == MouseInteractions.TouchStart);\n}\nvar Replayer = function () {\n  function Replayer(events, config) {\n    var _this = this;\n    this.mouseTail = null;\n    this.tailPositions = [];\n    this.emitter = mitt();\n    this.legacy_missingNodeRetryMap = {};\n    this.cache = createCache();\n    this.imageMap = new Map();\n    this.mirror = createMirror();\n    this.firstFullSnapshot = null;\n    this.newDocumentQueue = [];\n    this.mousePos = null;\n    this.touchActive = null;\n    if (!(config === null || config === void 0 ? void 0 : config.liveMode) && events.length < 2) {\n      throw new Error('Replayer need at least 2 events.');\n    }\n    var defaultConfig = {\n      speed: 1,\n      maxSpeed: 360,\n      root: document.body,\n      loadTimeout: 0,\n      skipInactive: false,\n      showWarning: true,\n      showDebug: false,\n      blockClass: 'rr-block',\n      liveMode: false,\n      insertStyleRules: [],\n      triggerFocus: true,\n      UNSAFE_replayCanvas: false,\n      pauseAnimation: true,\n      mouseTail: defaultMouseTailConfig\n    };\n    this.config = Object.assign({}, defaultConfig, config);\n    this.handleResize = this.handleResize.bind(this);\n    this.getCastFn = this.getCastFn.bind(this);\n    this.applyEventsSynchronously = this.applyEventsSynchronously.bind(this);\n    this.emitter.on(ReplayerEvents.Resize, this.handleResize);\n    this.setupDom();\n    this.treeIndex = new TreeIndex();\n    this.fragmentParentMap = new Map();\n    this.elementStateMap = new Map();\n    this.virtualStyleRulesMap = new Map();\n    this.emitter.on(ReplayerEvents.Flush, function () {\n      var e_1, _a, e_2, _b, e_3, _c, e_4, _d;\n      var _e = _this.treeIndex.flush(),\n        scrollMap = _e.scrollMap,\n        inputMap = _e.inputMap,\n        mutationData = _e.mutationData;\n      _this.fragmentParentMap.forEach(function (parent, frag) {\n        return _this.restoreRealParent(frag, parent);\n      });\n      try {\n        for (var _f = __values(mutationData.texts), _g = _f.next(); !_g.done; _g = _f.next()) {\n          var d = _g.value;\n          _this.applyText(d, mutationData);\n        }\n      } catch (e_1_1) {\n        e_1 = {\n          error: e_1_1\n        };\n      } finally {\n        try {\n          if (_g && !_g.done && (_a = _f.return)) _a.call(_f);\n        } finally {\n          if (e_1) throw e_1.error;\n        }\n      }\n      try {\n        for (var _h = __values(_this.virtualStyleRulesMap.keys()), _j = _h.next(); !_j.done; _j = _h.next()) {\n          var node = _j.value;\n          _this.restoreNodeSheet(node);\n        }\n      } catch (e_2_1) {\n        e_2 = {\n          error: e_2_1\n        };\n      } finally {\n        try {\n          if (_j && !_j.done && (_b = _h.return)) _b.call(_h);\n        } finally {\n          if (e_2) throw e_2.error;\n        }\n      }\n      _this.fragmentParentMap.clear();\n      _this.elementStateMap.clear();\n      _this.virtualStyleRulesMap.clear();\n      try {\n        for (var _k = __values(scrollMap.values()), _l = _k.next(); !_l.done; _l = _k.next()) {\n          var d = _l.value;\n          _this.applyScroll(d, true);\n        }\n      } catch (e_3_1) {\n        e_3 = {\n          error: e_3_1\n        };\n      } finally {\n        try {\n          if (_l && !_l.done && (_c = _k.return)) _c.call(_k);\n        } finally {\n          if (e_3) throw e_3.error;\n        }\n      }\n      try {\n        for (var _m = __values(inputMap.values()), _o = _m.next(); !_o.done; _o = _m.next()) {\n          var d = _o.value;\n          _this.applyInput(d);\n        }\n      } catch (e_4_1) {\n        e_4 = {\n          error: e_4_1\n        };\n      } finally {\n        try {\n          if (_o && !_o.done && (_d = _m.return)) _d.call(_m);\n        } finally {\n          if (e_4) throw e_4.error;\n        }\n      }\n    });\n    this.emitter.on(ReplayerEvents.PlayBack, function () {\n      _this.firstFullSnapshot = null;\n      _this.mirror.reset();\n    });\n    var timer = new Timer([], (config === null || config === void 0 ? void 0 : config.speed) || defaultConfig.speed);\n    this.service = createPlayerService({\n      events: events.map(function (e) {\n        if (config && config.unpackFn) {\n          return config.unpackFn(e);\n        }\n        return e;\n      }).sort(function (a1, a2) {\n        return a1.timestamp - a2.timestamp;\n      }),\n      timer: timer,\n      timeOffset: 0,\n      baselineTime: 0,\n      lastPlayedEvent: null\n    }, {\n      getCastFn: this.getCastFn,\n      applyEventsSynchronously: this.applyEventsSynchronously,\n      emitter: this.emitter\n    });\n    this.service.start();\n    this.service.subscribe(function (state) {\n      _this.emitter.emit(ReplayerEvents.StateChange, {\n        player: state\n      });\n    });\n    this.speedService = createSpeedService({\n      normalSpeed: -1,\n      timer: timer\n    });\n    this.speedService.start();\n    this.speedService.subscribe(function (state) {\n      _this.emitter.emit(ReplayerEvents.StateChange, {\n        speed: state\n      });\n    });\n    var firstMeta = this.service.state.context.events.find(function (e) {\n      return e.type === EventType.Meta;\n    });\n    var firstFullsnapshot = this.service.state.context.events.find(function (e) {\n      return e.type === EventType.FullSnapshot;\n    });\n    if (firstMeta) {\n      var _a = firstMeta.data,\n        width_1 = _a.width,\n        height_1 = _a.height;\n      setTimeout(function () {\n        _this.emitter.emit(ReplayerEvents.Resize, {\n          width: width_1,\n          height: height_1\n        });\n      }, 0);\n    }\n    if (firstFullsnapshot) {\n      setTimeout(function () {\n        if (_this.firstFullSnapshot) {\n          return;\n        }\n        _this.firstFullSnapshot = firstFullsnapshot;\n        _this.rebuildFullSnapshot(firstFullsnapshot);\n        _this.iframe.contentWindow.scrollTo(firstFullsnapshot.data.initialOffset);\n      }, 1);\n    }\n    if (this.service.state.context.events.find(indicatesTouchDevice)) {\n      this.mouse.classList.add('touch-device');\n    }\n  }\n  Object.defineProperty(Replayer.prototype, \"timer\", {\n    get: function () {\n      return this.service.state.context.timer;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Replayer.prototype.on = function (event, handler) {\n    this.emitter.on(event, handler);\n    return this;\n  };\n  Replayer.prototype.off = function (event, handler) {\n    this.emitter.off(event, handler);\n    return this;\n  };\n  Replayer.prototype.setConfig = function (config) {\n    var _this = this;\n    Object.keys(config).forEach(function (key) {\n      _this.config[key] = config[key];\n    });\n    if (!this.config.skipInactive) {\n      this.backToNormal();\n    }\n    if (typeof config.speed !== 'undefined') {\n      this.speedService.send({\n        type: 'SET_SPEED',\n        payload: {\n          speed: config.speed\n        }\n      });\n    }\n    if (typeof config.mouseTail !== 'undefined') {\n      if (config.mouseTail === false) {\n        if (this.mouseTail) {\n          this.mouseTail.style.display = 'none';\n        }\n      } else {\n        if (!this.mouseTail) {\n          this.mouseTail = document.createElement('canvas');\n          this.mouseTail.width = Number.parseFloat(this.iframe.width);\n          this.mouseTail.height = Number.parseFloat(this.iframe.height);\n          this.mouseTail.classList.add('replayer-mouse-tail');\n          this.wrapper.insertBefore(this.mouseTail, this.iframe);\n        }\n        this.mouseTail.style.display = 'inherit';\n      }\n    }\n  };\n  Replayer.prototype.getMetaData = function () {\n    var firstEvent = this.service.state.context.events[0];\n    var lastEvent = this.service.state.context.events[this.service.state.context.events.length - 1];\n    return {\n      startTime: firstEvent.timestamp,\n      endTime: lastEvent.timestamp,\n      totalTime: lastEvent.timestamp - firstEvent.timestamp\n    };\n  };\n  Replayer.prototype.getCurrentTime = function () {\n    return this.timer.timeOffset + this.getTimeOffset();\n  };\n  Replayer.prototype.getTimeOffset = function () {\n    var _a = this.service.state.context,\n      baselineTime = _a.baselineTime,\n      events = _a.events;\n    return baselineTime - events[0].timestamp;\n  };\n  Replayer.prototype.getMirror = function () {\n    return this.mirror;\n  };\n  Replayer.prototype.play = function (timeOffset) {\n    var _a;\n    if (timeOffset === void 0) {\n      timeOffset = 0;\n    }\n    if (this.service.state.matches('paused')) {\n      this.service.send({\n        type: 'PLAY',\n        payload: {\n          timeOffset: timeOffset\n        }\n      });\n    } else {\n      this.service.send({\n        type: 'PAUSE'\n      });\n      this.service.send({\n        type: 'PLAY',\n        payload: {\n          timeOffset: timeOffset\n        }\n      });\n    }\n    (_a = this.iframe.contentDocument) === null || _a === void 0 ? void 0 : _a.getElementsByTagName('html')[0].classList.remove('rrweb-paused');\n    this.emitter.emit(ReplayerEvents.Start);\n  };\n  Replayer.prototype.pause = function (timeOffset) {\n    var _a;\n    if (timeOffset === undefined && this.service.state.matches('playing')) {\n      this.service.send({\n        type: 'PAUSE'\n      });\n    }\n    if (typeof timeOffset === 'number') {\n      this.play(timeOffset);\n      this.service.send({\n        type: 'PAUSE'\n      });\n    }\n    (_a = this.iframe.contentDocument) === null || _a === void 0 ? void 0 : _a.getElementsByTagName('html')[0].classList.add('rrweb-paused');\n    this.emitter.emit(ReplayerEvents.Pause);\n  };\n  Replayer.prototype.resume = function (timeOffset) {\n    if (timeOffset === void 0) {\n      timeOffset = 0;\n    }\n    console.warn(\"The 'resume' will be departed in 1.0. Please use 'play' method which has the same interface.\");\n    this.play(timeOffset);\n    this.emitter.emit(ReplayerEvents.Resume);\n  };\n  Replayer.prototype.startLive = function (baselineTime) {\n    this.service.send({\n      type: 'TO_LIVE',\n      payload: {\n        baselineTime: baselineTime\n      }\n    });\n  };\n  Replayer.prototype.addEvent = function (rawEvent) {\n    var _this = this;\n    var event = this.config.unpackFn ? this.config.unpackFn(rawEvent) : rawEvent;\n    if (indicatesTouchDevice(event)) {\n      this.mouse.classList.add('touch-device');\n    }\n    Promise.resolve().then(function () {\n      return _this.service.send({\n        type: 'ADD_EVENT',\n        payload: {\n          event: event\n        }\n      });\n    });\n  };\n  Replayer.prototype.enableInteract = function () {\n    this.iframe.setAttribute('scrolling', 'auto');\n    this.iframe.style.pointerEvents = 'auto';\n  };\n  Replayer.prototype.disableInteract = function () {\n    this.iframe.setAttribute('scrolling', 'no');\n    this.iframe.style.pointerEvents = 'none';\n  };\n  Replayer.prototype.resetCache = function () {\n    this.cache = createCache();\n  };\n  Replayer.prototype.setupDom = function () {\n    this.wrapper = document.createElement('div');\n    this.wrapper.classList.add('replayer-wrapper');\n    this.config.root.appendChild(this.wrapper);\n    this.mouse = document.createElement('div');\n    this.mouse.classList.add('replayer-mouse');\n    this.wrapper.appendChild(this.mouse);\n    if (this.config.mouseTail !== false) {\n      this.mouseTail = document.createElement('canvas');\n      this.mouseTail.classList.add('replayer-mouse-tail');\n      this.mouseTail.style.display = 'inherit';\n      this.wrapper.appendChild(this.mouseTail);\n    }\n    this.iframe = document.createElement('iframe');\n    var attributes = ['allow-same-origin'];\n    if (this.config.UNSAFE_replayCanvas) {\n      attributes.push('allow-scripts');\n    }\n    this.iframe.style.display = 'none';\n    this.iframe.setAttribute('sandbox', attributes.join(' '));\n    this.disableInteract();\n    this.wrapper.appendChild(this.iframe);\n    if (this.iframe.contentWindow && this.iframe.contentDocument) {\n      polyfill(this.iframe.contentWindow, this.iframe.contentDocument);\n      polyfill$1(this.iframe.contentWindow);\n    }\n  };\n  Replayer.prototype.handleResize = function (dimension) {\n    var e_5, _a;\n    this.iframe.style.display = 'inherit';\n    try {\n      for (var _b = __values([this.mouseTail, this.iframe]), _c = _b.next(); !_c.done; _c = _b.next()) {\n        var el = _c.value;\n        if (!el) {\n          continue;\n        }\n        el.setAttribute('width', String(dimension.width));\n        el.setAttribute('height', String(dimension.height));\n      }\n    } catch (e_5_1) {\n      e_5 = {\n        error: e_5_1\n      };\n    } finally {\n      try {\n        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n      } finally {\n        if (e_5) throw e_5.error;\n      }\n    }\n  };\n  Replayer.prototype.applyEventsSynchronously = function (events) {\n    var e_6, _a;\n    try {\n      for (var events_1 = __values(events), events_1_1 = events_1.next(); !events_1_1.done; events_1_1 = events_1.next()) {\n        var event_1 = events_1_1.value;\n        switch (event_1.type) {\n          case EventType.DomContentLoaded:\n          case EventType.Load:\n          case EventType.Custom:\n            continue;\n          case EventType.FullSnapshot:\n          case EventType.Meta:\n          case EventType.Plugin:\n            break;\n          case EventType.IncrementalSnapshot:\n            switch (event_1.data.source) {\n              case IncrementalSource.MediaInteraction:\n                continue;\n              default:\n                break;\n            }\n            break;\n          default:\n            break;\n        }\n        var castFn = this.getCastFn(event_1, true);\n        castFn();\n      }\n    } catch (e_6_1) {\n      e_6 = {\n        error: e_6_1\n      };\n    } finally {\n      try {\n        if (events_1_1 && !events_1_1.done && (_a = events_1.return)) _a.call(events_1);\n      } finally {\n        if (e_6) throw e_6.error;\n      }\n    }\n    if (this.mousePos) {\n      this.moveAndHover(this.mousePos.x, this.mousePos.y, this.mousePos.id, true, this.mousePos.debugData);\n    }\n    this.mousePos = null;\n    if (this.touchActive === true) {\n      this.mouse.classList.add('touch-active');\n    } else if (this.touchActive === false) {\n      this.mouse.classList.remove('touch-active');\n    }\n    this.touchActive = null;\n  };\n  Replayer.prototype.getCastFn = function (event, isSync) {\n    var _this = this;\n    if (isSync === void 0) {\n      isSync = false;\n    }\n    var castFn;\n    switch (event.type) {\n      case EventType.DomContentLoaded:\n      case EventType.Load:\n        break;\n      case EventType.Custom:\n        castFn = function () {\n          _this.emitter.emit(ReplayerEvents.CustomEvent, event);\n        };\n        break;\n      case EventType.Meta:\n        castFn = function () {\n          return _this.emitter.emit(ReplayerEvents.Resize, {\n            width: event.data.width,\n            height: event.data.height\n          });\n        };\n        break;\n      case EventType.FullSnapshot:\n        castFn = function () {\n          if (_this.firstFullSnapshot) {\n            if (_this.firstFullSnapshot === event) {\n              _this.firstFullSnapshot = true;\n              return;\n            }\n          } else {\n            _this.firstFullSnapshot = true;\n          }\n          _this.rebuildFullSnapshot(event, isSync);\n          _this.iframe.contentWindow.scrollTo(event.data.initialOffset);\n        };\n        break;\n      case EventType.IncrementalSnapshot:\n        castFn = function () {\n          var e_7, _a;\n          _this.applyIncremental(event, isSync);\n          if (isSync) {\n            return;\n          }\n          if (event === _this.nextUserInteractionEvent) {\n            _this.nextUserInteractionEvent = null;\n            _this.backToNormal();\n          }\n          if (_this.config.skipInactive && !_this.nextUserInteractionEvent) {\n            try {\n              for (var _b = __values(_this.service.state.context.events), _c = _b.next(); !_c.done; _c = _b.next()) {\n                var _event = _c.value;\n                if (_event.timestamp <= event.timestamp) {\n                  continue;\n                }\n                if (_this.isUserInteraction(_event)) {\n                  if (_event.delay - event.delay > SKIP_TIME_THRESHOLD * _this.speedService.state.context.timer.speed) {\n                    _this.nextUserInteractionEvent = _event;\n                  }\n                  break;\n                }\n              }\n            } catch (e_7_1) {\n              e_7 = {\n                error: e_7_1\n              };\n            } finally {\n              try {\n                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n              } finally {\n                if (e_7) throw e_7.error;\n              }\n            }\n            if (_this.nextUserInteractionEvent) {\n              var skipTime = _this.nextUserInteractionEvent.delay - event.delay;\n              var payload = {\n                speed: Math.min(Math.round(skipTime / SKIP_TIME_INTERVAL), _this.config.maxSpeed)\n              };\n              _this.speedService.send({\n                type: 'FAST_FORWARD',\n                payload: payload\n              });\n              _this.emitter.emit(ReplayerEvents.SkipStart, payload);\n            }\n          }\n        };\n        break;\n    }\n    var wrappedCastFn = function () {\n      var e_8, _a;\n      if (castFn) {\n        castFn();\n      }\n      try {\n        for (var _b = __values(_this.config.plugins || []), _c = _b.next(); !_c.done; _c = _b.next()) {\n          var plugin = _c.value;\n          plugin.handler(event, isSync, {\n            replayer: _this\n          });\n        }\n      } catch (e_8_1) {\n        e_8 = {\n          error: e_8_1\n        };\n      } finally {\n        try {\n          if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n        } finally {\n          if (e_8) throw e_8.error;\n        }\n      }\n      _this.service.send({\n        type: 'CAST_EVENT',\n        payload: {\n          event: event\n        }\n      });\n      var last_index = _this.service.state.context.events.length - 1;\n      if (event === _this.service.state.context.events[last_index]) {\n        var finish_1 = function () {\n          if (last_index < _this.service.state.context.events.length - 1) {\n            return;\n          }\n          _this.backToNormal();\n          _this.service.send('END');\n          _this.emitter.emit(ReplayerEvents.Finish);\n        };\n        if (event.type === EventType.IncrementalSnapshot && event.data.source === IncrementalSource.MouseMove && event.data.positions.length) {\n          setTimeout(function () {\n            finish_1();\n          }, Math.max(0, -event.data.positions[0].timeOffset + 50));\n        } else {\n          finish_1();\n        }\n      }\n      _this.emitter.emit(ReplayerEvents.EventCast, event);\n    };\n    return wrappedCastFn;\n  };\n  Replayer.prototype.rebuildFullSnapshot = function (event, isSync) {\n    var e_9, _a;\n    var _this = this;\n    if (isSync === void 0) {\n      isSync = false;\n    }\n    if (!this.iframe.contentDocument) {\n      return console.warn('Looks like your replayer has been destroyed.');\n    }\n    if (Object.keys(this.legacy_missingNodeRetryMap).length) {\n      console.warn('Found unresolved missing node map', this.legacy_missingNodeRetryMap);\n    }\n    this.legacy_missingNodeRetryMap = {};\n    var collected = [];\n    this.mirror.map = rebuild(event.data.node, {\n      doc: this.iframe.contentDocument,\n      afterAppend: function (builtNode) {\n        _this.collectIframeAndAttachDocument(collected, builtNode);\n      },\n      cache: this.cache\n    })[1];\n    var _loop_1 = function (mutationInQueue, builtNode) {\n      this_1.attachDocumentToIframe(mutationInQueue, builtNode);\n      this_1.newDocumentQueue = this_1.newDocumentQueue.filter(function (m) {\n        return m !== mutationInQueue;\n      });\n    };\n    var this_1 = this;\n    try {\n      for (var collected_1 = __values(collected), collected_1_1 = collected_1.next(); !collected_1_1.done; collected_1_1 = collected_1.next()) {\n        var _b = collected_1_1.value,\n          mutationInQueue = _b.mutationInQueue,\n          builtNode = _b.builtNode;\n        _loop_1(mutationInQueue, builtNode);\n      }\n    } catch (e_9_1) {\n      e_9 = {\n        error: e_9_1\n      };\n    } finally {\n      try {\n        if (collected_1_1 && !collected_1_1.done && (_a = collected_1.return)) _a.call(collected_1);\n      } finally {\n        if (e_9) throw e_9.error;\n      }\n    }\n    var _c = this.iframe.contentDocument,\n      documentElement = _c.documentElement,\n      head = _c.head;\n    this.insertStyleRules(documentElement, head);\n    if (!this.service.state.matches('playing')) {\n      this.iframe.contentDocument.getElementsByTagName('html')[0].classList.add('rrweb-paused');\n    }\n    this.emitter.emit(ReplayerEvents.FullsnapshotRebuilded, event);\n    if (!isSync) {\n      this.waitForStylesheetLoad();\n    }\n    if (this.config.UNSAFE_replayCanvas) {\n      this.preloadAllImages();\n    }\n  };\n  Replayer.prototype.insertStyleRules = function (documentElement, head) {\n    var styleEl = document.createElement('style');\n    documentElement.insertBefore(styleEl, head);\n    var injectStylesRules = rules(this.config.blockClass).concat(this.config.insertStyleRules);\n    if (this.config.pauseAnimation) {\n      injectStylesRules.push('html.rrweb-paused *, html.rrweb-paused *:before, html.rrweb-paused *:after { animation-play-state: paused !important; }');\n    }\n    for (var idx = 0; idx < injectStylesRules.length; idx++) {\n      styleEl.sheet.insertRule(injectStylesRules[idx], idx);\n    }\n  };\n  Replayer.prototype.attachDocumentToIframe = function (mutation, iframeEl) {\n    var e_10, _a;\n    var _this = this;\n    var collected = [];\n    if (!iframeEl.contentDocument) {\n      var parent_1 = iframeEl.parentNode;\n      while (parent_1) {\n        if (this.fragmentParentMap.has(parent_1)) {\n          var frag = parent_1;\n          var realParent = this.fragmentParentMap.get(frag);\n          this.restoreRealParent(frag, realParent);\n          break;\n        }\n        parent_1 = parent_1.parentNode;\n      }\n    }\n    buildNodeWithSN(mutation.node, {\n      doc: iframeEl.contentDocument,\n      map: this.mirror.map,\n      hackCss: true,\n      skipChild: false,\n      afterAppend: function (builtNode) {\n        _this.collectIframeAndAttachDocument(collected, builtNode);\n        if (builtNode.__sn.type === NodeType.Element && builtNode.__sn.tagName.toUpperCase() === 'HTML') {\n          var _a = iframeEl.contentDocument,\n            documentElement = _a.documentElement,\n            head = _a.head;\n          _this.insertStyleRules(documentElement, head);\n        }\n      },\n      cache: this.cache\n    });\n    var _loop_2 = function (mutationInQueue, builtNode) {\n      this_2.attachDocumentToIframe(mutationInQueue, builtNode);\n      this_2.newDocumentQueue = this_2.newDocumentQueue.filter(function (m) {\n        return m !== mutationInQueue;\n      });\n    };\n    var this_2 = this;\n    try {\n      for (var collected_2 = __values(collected), collected_2_1 = collected_2.next(); !collected_2_1.done; collected_2_1 = collected_2.next()) {\n        var _b = collected_2_1.value,\n          mutationInQueue = _b.mutationInQueue,\n          builtNode = _b.builtNode;\n        _loop_2(mutationInQueue, builtNode);\n      }\n    } catch (e_10_1) {\n      e_10 = {\n        error: e_10_1\n      };\n    } finally {\n      try {\n        if (collected_2_1 && !collected_2_1.done && (_a = collected_2.return)) _a.call(collected_2);\n      } finally {\n        if (e_10) throw e_10.error;\n      }\n    }\n  };\n  Replayer.prototype.collectIframeAndAttachDocument = function (collected, builtNode) {\n    if (isIframeINode(builtNode)) {\n      var mutationInQueue = this.newDocumentQueue.find(function (m) {\n        return m.parentId === builtNode.__sn.id;\n      });\n      if (mutationInQueue) {\n        collected.push({\n          mutationInQueue: mutationInQueue,\n          builtNode: builtNode\n        });\n      }\n    }\n  };\n  Replayer.prototype.waitForStylesheetLoad = function () {\n    var _this = this;\n    var _a;\n    var head = (_a = this.iframe.contentDocument) === null || _a === void 0 ? void 0 : _a.head;\n    if (head) {\n      var unloadSheets_1 = new Set();\n      var timer_1;\n      var beforeLoadState_1 = this.service.state;\n      var stateHandler_1 = function () {\n        beforeLoadState_1 = _this.service.state;\n      };\n      this.emitter.on(ReplayerEvents.Start, stateHandler_1);\n      this.emitter.on(ReplayerEvents.Pause, stateHandler_1);\n      var unsubscribe_1 = function () {\n        _this.emitter.off(ReplayerEvents.Start, stateHandler_1);\n        _this.emitter.off(ReplayerEvents.Pause, stateHandler_1);\n      };\n      head.querySelectorAll('link[rel=\"stylesheet\"]').forEach(function (css) {\n        if (!css.sheet) {\n          unloadSheets_1.add(css);\n          css.addEventListener('load', function () {\n            unloadSheets_1.delete(css);\n            if (unloadSheets_1.size === 0 && timer_1 !== -1) {\n              if (beforeLoadState_1.matches('playing')) {\n                _this.play(_this.getCurrentTime());\n              }\n              _this.emitter.emit(ReplayerEvents.LoadStylesheetEnd);\n              if (timer_1) {\n                clearTimeout(timer_1);\n              }\n              unsubscribe_1();\n            }\n          });\n        }\n      });\n      if (unloadSheets_1.size > 0) {\n        this.service.send({\n          type: 'PAUSE'\n        });\n        this.emitter.emit(ReplayerEvents.LoadStylesheetStart);\n        timer_1 = setTimeout(function () {\n          if (beforeLoadState_1.matches('playing')) {\n            _this.play(_this.getCurrentTime());\n          }\n          timer_1 = -1;\n          unsubscribe_1();\n        }, this.config.loadTimeout);\n      }\n    }\n  };\n  Replayer.prototype.hasImageArg = function (args) {\n    var e_11, _a;\n    try {\n      for (var args_1 = __values(args), args_1_1 = args_1.next(); !args_1_1.done; args_1_1 = args_1.next()) {\n        var arg = args_1_1.value;\n        if (!arg || typeof arg !== 'object') {} else if ('rr_type' in arg && 'args' in arg) {\n          if (this.hasImageArg(arg.args)) return true;\n        } else if ('rr_type' in arg && arg.rr_type === 'HTMLImageElement') {\n          return true;\n        } else if (arg instanceof Array) {\n          if (this.hasImageArg(arg)) return true;\n        }\n      }\n    } catch (e_11_1) {\n      e_11 = {\n        error: e_11_1\n      };\n    } finally {\n      try {\n        if (args_1_1 && !args_1_1.done && (_a = args_1.return)) _a.call(args_1);\n      } finally {\n        if (e_11) throw e_11.error;\n      }\n    }\n    return false;\n  };\n  Replayer.prototype.getImageArgs = function (args) {\n    var e_12, _a;\n    var images = [];\n    try {\n      for (var args_2 = __values(args), args_2_1 = args_2.next(); !args_2_1.done; args_2_1 = args_2.next()) {\n        var arg = args_2_1.value;\n        if (!arg || typeof arg !== 'object') {} else if ('rr_type' in arg && 'args' in arg) {\n          images.push.apply(images, __spreadArray([], __read(this.getImageArgs(arg.args)), false));\n        } else if ('rr_type' in arg && arg.rr_type === 'HTMLImageElement') {\n          images.push(arg.src);\n        } else if (arg instanceof Array) {\n          images.push.apply(images, __spreadArray([], __read(this.getImageArgs(arg)), false));\n        }\n      }\n    } catch (e_12_1) {\n      e_12 = {\n        error: e_12_1\n      };\n    } finally {\n      try {\n        if (args_2_1 && !args_2_1.done && (_a = args_2.return)) _a.call(args_2);\n      } finally {\n        if (e_12) throw e_12.error;\n      }\n    }\n    return images;\n  };\n  Replayer.prototype.preloadAllImages = function () {\n    var e_13, _a;\n    var _this = this;\n    this.service.state;\n    var stateHandler = function () {\n      _this.service.state;\n    };\n    this.emitter.on(ReplayerEvents.Start, stateHandler);\n    this.emitter.on(ReplayerEvents.Pause, stateHandler);\n    var _loop_3 = function (event_2) {\n      if (event_2.type === EventType.IncrementalSnapshot && event_2.data.source === IncrementalSource.CanvasMutation) if ('commands' in event_2.data) {\n        event_2.data.commands.forEach(function (c) {\n          return _this.preloadImages(c, event_2);\n        });\n      } else {\n        this_3.preloadImages(event_2.data, event_2);\n      }\n    };\n    var this_3 = this;\n    try {\n      for (var _b = __values(this.service.state.context.events), _c = _b.next(); !_c.done; _c = _b.next()) {\n        var event_2 = _c.value;\n        _loop_3(event_2);\n      }\n    } catch (e_13_1) {\n      e_13 = {\n        error: e_13_1\n      };\n    } finally {\n      try {\n        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n      } finally {\n        if (e_13) throw e_13.error;\n      }\n    }\n  };\n  Replayer.prototype.preloadImages = function (data, event) {\n    var _this = this;\n    if (data.property === 'drawImage' && typeof data.args[0] === 'string' && !this.imageMap.has(event)) {\n      var canvas = document.createElement('canvas');\n      var ctx = canvas.getContext('2d');\n      var imgd = ctx === null || ctx === void 0 ? void 0 : ctx.createImageData(canvas.width, canvas.height);\n      imgd === null || imgd === void 0 ? void 0 : imgd.data;\n      JSON.parse(data.args[0]);\n      ctx === null || ctx === void 0 ? void 0 : ctx.putImageData(imgd, 0, 0);\n    } else if (this.hasImageArg(data.args)) {\n      this.getImageArgs(data.args).forEach(function (url) {\n        var image = new Image();\n        image.src = url;\n        _this.imageMap.set(url, image);\n      });\n    }\n  };\n  Replayer.prototype.applyIncremental = function (e, isSync) {\n    var _this = this;\n    var _a, _b;\n    var d = e.data;\n    switch (d.source) {\n      case IncrementalSource.Mutation:\n        {\n          if (isSync) {\n            d.adds.forEach(function (m) {\n              return _this.treeIndex.add(m);\n            });\n            d.texts.forEach(function (m) {\n              var target = _this.mirror.getNode(m.id);\n              var parent = target === null || target === void 0 ? void 0 : target.parentNode;\n              if (parent && _this.virtualStyleRulesMap.has(parent)) _this.virtualStyleRulesMap.delete(parent);\n              _this.treeIndex.text(m);\n            });\n            d.attributes.forEach(function (m) {\n              return _this.treeIndex.attribute(m);\n            });\n            d.removes.forEach(function (m) {\n              return _this.treeIndex.remove(m, _this.mirror);\n            });\n          }\n          try {\n            this.applyMutation(d, isSync);\n          } catch (error) {\n            this.warn(\"Exception in mutation \".concat(error.message || error), d);\n          }\n          break;\n        }\n      case IncrementalSource.Drag:\n      case IncrementalSource.TouchMove:\n      case IncrementalSource.MouseMove:\n        if (isSync) {\n          var lastPosition = d.positions[d.positions.length - 1];\n          this.mousePos = {\n            x: lastPosition.x,\n            y: lastPosition.y,\n            id: lastPosition.id,\n            debugData: d\n          };\n        } else {\n          d.positions.forEach(function (p) {\n            var action = {\n              doAction: function () {\n                _this.moveAndHover(p.x, p.y, p.id, isSync, d);\n              },\n              delay: p.timeOffset + e.timestamp - _this.service.state.context.baselineTime\n            };\n            _this.timer.addAction(action);\n          });\n          this.timer.addAction({\n            doAction: function () {},\n            delay: e.delay - ((_a = d.positions[0]) === null || _a === void 0 ? void 0 : _a.timeOffset)\n          });\n        }\n        break;\n      case IncrementalSource.MouseInteraction:\n        {\n          if (d.id === -1) {\n            break;\n          }\n          var event_3 = new Event(MouseInteractions[d.type].toLowerCase());\n          var target = this.mirror.getNode(d.id);\n          if (!target) {\n            return this.debugNodeNotFound(d, d.id);\n          }\n          this.emitter.emit(ReplayerEvents.MouseInteraction, {\n            type: d.type,\n            target: target\n          });\n          var triggerFocus = this.config.triggerFocus;\n          switch (d.type) {\n            case MouseInteractions.Blur:\n              if ('blur' in target) {\n                target.blur();\n              }\n              break;\n            case MouseInteractions.Focus:\n              if (triggerFocus && target.focus) {\n                target.focus({\n                  preventScroll: true\n                });\n              }\n              break;\n            case MouseInteractions.Click:\n            case MouseInteractions.TouchStart:\n            case MouseInteractions.TouchEnd:\n              if (isSync) {\n                if (d.type === MouseInteractions.TouchStart) {\n                  this.touchActive = true;\n                } else if (d.type === MouseInteractions.TouchEnd) {\n                  this.touchActive = false;\n                }\n                this.mousePos = {\n                  x: d.x,\n                  y: d.y,\n                  id: d.id,\n                  debugData: d\n                };\n              } else {\n                if (d.type === MouseInteractions.TouchStart) {\n                  this.tailPositions.length = 0;\n                }\n                this.moveAndHover(d.x, d.y, d.id, isSync, d);\n                if (d.type === MouseInteractions.Click) {\n                  this.mouse.classList.remove('active');\n                  void this.mouse.offsetWidth;\n                  this.mouse.classList.add('active');\n                } else if (d.type === MouseInteractions.TouchStart) {\n                  void this.mouse.offsetWidth;\n                  this.mouse.classList.add('touch-active');\n                } else if (d.type === MouseInteractions.TouchEnd) {\n                  this.mouse.classList.remove('touch-active');\n                }\n              }\n              break;\n            case MouseInteractions.TouchCancel:\n              if (isSync) {\n                this.touchActive = false;\n              } else {\n                this.mouse.classList.remove('touch-active');\n              }\n              break;\n            default:\n              target.dispatchEvent(event_3);\n          }\n          break;\n        }\n      case IncrementalSource.Scroll:\n        {\n          if (d.id === -1) {\n            break;\n          }\n          if (isSync) {\n            this.treeIndex.scroll(d);\n            break;\n          }\n          this.applyScroll(d, false);\n          break;\n        }\n      case IncrementalSource.ViewportResize:\n        this.emitter.emit(ReplayerEvents.Resize, {\n          width: d.width,\n          height: d.height\n        });\n        break;\n      case IncrementalSource.Input:\n        {\n          if (d.id === -1) {\n            break;\n          }\n          if (isSync) {\n            this.treeIndex.input(d);\n            break;\n          }\n          this.applyInput(d);\n          break;\n        }\n      case IncrementalSource.MediaInteraction:\n        {\n          var target = this.mirror.getNode(d.id);\n          if (!target) {\n            return this.debugNodeNotFound(d, d.id);\n          }\n          var mediaEl = target;\n          try {\n            if (d.currentTime) {\n              mediaEl.currentTime = d.currentTime;\n            }\n            if (d.volume) {\n              mediaEl.volume = d.volume;\n            }\n            if (d.muted) {\n              mediaEl.muted = d.muted;\n            }\n            if (d.type === 1) {\n              mediaEl.pause();\n            }\n            if (d.type === 0) {\n              mediaEl.play();\n            }\n          } catch (error) {\n            if (this.config.showWarning) {\n              console.warn(\"Failed to replay media interactions: \".concat(error.message || error));\n            }\n          }\n          break;\n        }\n      case IncrementalSource.StyleSheetRule:\n        {\n          var target = this.mirror.getNode(d.id);\n          if (!target) {\n            return this.debugNodeNotFound(d, d.id);\n          }\n          var styleEl = target;\n          var parent_2 = target.parentNode;\n          var usingVirtualParent_1 = this.fragmentParentMap.has(parent_2);\n          var styleSheet_1 = usingVirtualParent_1 ? null : styleEl.sheet;\n          var rules_1;\n          if (!styleSheet_1) {\n            if (this.virtualStyleRulesMap.has(target)) {\n              rules_1 = this.virtualStyleRulesMap.get(target);\n            } else {\n              rules_1 = [];\n              this.virtualStyleRulesMap.set(target, rules_1);\n            }\n          }\n          if (d.adds) {\n            d.adds.forEach(function (_a) {\n              var rule = _a.rule,\n                nestedIndex = _a.index;\n              if (styleSheet_1) {\n                try {\n                  if (Array.isArray(nestedIndex)) {\n                    var _b = getPositionsAndIndex(nestedIndex),\n                      positions = _b.positions,\n                      index = _b.index;\n                    var nestedRule = getNestedRule(styleSheet_1.cssRules, positions);\n                    nestedRule.insertRule(rule, index);\n                  } else {\n                    var index = nestedIndex === undefined ? undefined : Math.min(nestedIndex, styleSheet_1.cssRules.length);\n                    styleSheet_1.insertRule(rule, index);\n                  }\n                } catch (e) {}\n              } else {\n                rules_1 === null || rules_1 === void 0 ? void 0 : rules_1.push({\n                  cssText: rule,\n                  index: nestedIndex,\n                  type: StyleRuleType.Insert\n                });\n              }\n            });\n          }\n          if (d.removes) {\n            d.removes.forEach(function (_a) {\n              var nestedIndex = _a.index;\n              if (usingVirtualParent_1) {\n                rules_1 === null || rules_1 === void 0 ? void 0 : rules_1.push({\n                  index: nestedIndex,\n                  type: StyleRuleType.Remove\n                });\n              } else {\n                try {\n                  if (Array.isArray(nestedIndex)) {\n                    var _b = getPositionsAndIndex(nestedIndex),\n                      positions = _b.positions,\n                      index = _b.index;\n                    var nestedRule = getNestedRule(styleSheet_1.cssRules, positions);\n                    nestedRule.deleteRule(index || 0);\n                  } else {\n                    styleSheet_1 === null || styleSheet_1 === void 0 ? void 0 : styleSheet_1.deleteRule(nestedIndex);\n                  }\n                } catch (e) {}\n              }\n            });\n          }\n          break;\n        }\n      case IncrementalSource.StyleDeclaration:\n        {\n          var target = this.mirror.getNode(d.id);\n          if (!target) {\n            return this.debugNodeNotFound(d, d.id);\n          }\n          var styleEl = target;\n          var parent_3 = target.parentNode;\n          var usingVirtualParent = this.fragmentParentMap.has(parent_3);\n          var styleSheet = usingVirtualParent ? null : styleEl.sheet;\n          var rules = [];\n          if (!styleSheet) {\n            if (this.virtualStyleRulesMap.has(target)) {\n              rules = this.virtualStyleRulesMap.get(target);\n            } else {\n              rules = [];\n              this.virtualStyleRulesMap.set(target, rules);\n            }\n          }\n          if (d.set) {\n            if (styleSheet) {\n              var rule = getNestedRule(styleSheet.rules, d.index);\n              rule.style.setProperty(d.set.property, d.set.value, d.set.priority);\n            } else {\n              rules.push(__assign({\n                type: StyleRuleType.SetProperty,\n                index: d.index\n              }, d.set));\n            }\n          }\n          if (d.remove) {\n            if (styleSheet) {\n              var rule = getNestedRule(styleSheet.rules, d.index);\n              rule.style.removeProperty(d.remove.property);\n            } else {\n              rules.push(__assign({\n                type: StyleRuleType.RemoveProperty,\n                index: d.index\n              }, d.remove));\n            }\n          }\n          break;\n        }\n      case IncrementalSource.CanvasMutation:\n        {\n          if (!this.config.UNSAFE_replayCanvas) {\n            return;\n          }\n          var target = this.mirror.getNode(d.id);\n          if (!target) {\n            return this.debugNodeNotFound(d, d.id);\n          }\n          canvasMutation({\n            event: e,\n            mutation: d,\n            target: target,\n            imageMap: this.imageMap,\n            errorHandler: this.warnCanvasMutationFailed.bind(this)\n          });\n          break;\n        }\n      case IncrementalSource.Font:\n        {\n          try {\n            var fontFace = new FontFace(d.family, d.buffer ? new Uint8Array(JSON.parse(d.fontSource)) : d.fontSource, d.descriptors);\n            (_b = this.iframe.contentDocument) === null || _b === void 0 ? void 0 : _b.fonts.add(fontFace);\n          } catch (error) {\n            if (this.config.showWarning) {\n              console.warn(error);\n            }\n          }\n          break;\n        }\n    }\n  };\n  Replayer.prototype.applyMutation = function (d, useVirtualParent) {\n    var e_14, _a;\n    var _this = this;\n    d.removes.forEach(function (mutation) {\n      var target = _this.mirror.getNode(mutation.id);\n      if (!target) {\n        if (d.removes.find(function (r) {\n          return r.id === mutation.parentId;\n        })) {\n          return;\n        }\n        return _this.warnNodeNotFound(d, mutation.id);\n      }\n      if (_this.virtualStyleRulesMap.has(target)) {\n        _this.virtualStyleRulesMap.delete(target);\n      }\n      var parent = _this.mirror.getNode(mutation.parentId);\n      if (!parent) {\n        return _this.warnNodeNotFound(d, mutation.parentId);\n      }\n      if (mutation.isShadow && hasShadowRoot(parent)) {\n        parent = parent.shadowRoot;\n      }\n      _this.mirror.removeNodeFromMap(target);\n      if (parent) {\n        var realTarget = null;\n        var realParent = '__sn' in parent ? _this.fragmentParentMap.get(parent) : undefined;\n        if (realParent && realParent.contains(target)) {\n          parent = realParent;\n        } else if (_this.fragmentParentMap.has(target)) {\n          realTarget = _this.fragmentParentMap.get(target);\n          _this.fragmentParentMap.delete(target);\n          target = realTarget;\n        }\n        try {\n          parent.removeChild(target);\n        } catch (error) {\n          if (error instanceof DOMException) {\n            _this.warn('parent could not remove child in mutation', parent, realParent, target, realTarget, d);\n          } else {\n            throw error;\n          }\n        }\n      }\n    });\n    var legacy_missingNodeMap = __assign({}, this.legacy_missingNodeRetryMap);\n    var queue = [];\n    var nextNotInDOM = function (mutation) {\n      var next = null;\n      if (mutation.nextId) {\n        next = _this.mirror.getNode(mutation.nextId);\n      }\n      if (mutation.nextId !== null && mutation.nextId !== undefined && mutation.nextId !== -1 && !next) {\n        return true;\n      }\n      return false;\n    };\n    var appendNode = function (mutation) {\n      var e_15, _a;\n      var _b, _c;\n      if (!_this.iframe.contentDocument) {\n        return console.warn('Looks like your replayer has been destroyed.');\n      }\n      var parent = _this.mirror.getNode(mutation.parentId);\n      if (!parent) {\n        if (mutation.node.type === NodeType.Document) {\n          return _this.newDocumentQueue.push(mutation);\n        }\n        return queue.push(mutation);\n      }\n      var parentInDocument = null;\n      if (_this.iframe.contentDocument.contains) {\n        parentInDocument = _this.iframe.contentDocument.contains(parent);\n      } else if (_this.iframe.contentDocument.body.contains) {\n        parentInDocument = _this.iframe.contentDocument.body.contains(parent);\n      }\n      var hasIframeChild = ((_c = (_b = parent).getElementsByTagName) === null || _c === void 0 ? void 0 : _c.call(_b, 'iframe').length) > 0;\n      if (useVirtualParent && parentInDocument && !isIframeINode(parent) && !hasIframeChild) {\n        var virtualParent = document.createDocumentFragment();\n        _this.mirror.map[mutation.parentId] = virtualParent;\n        _this.fragmentParentMap.set(virtualParent, parent);\n        _this.storeState(parent);\n        while (parent.firstChild) {\n          virtualParent.appendChild(parent.firstChild);\n        }\n        parent = virtualParent;\n      }\n      if (mutation.node.isShadow) {\n        if (!hasShadowRoot(parent)) {\n          parent.attachShadow({\n            mode: 'open'\n          });\n          parent = parent.shadowRoot;\n        } else parent = parent.shadowRoot;\n      }\n      var previous = null;\n      var next = null;\n      if (mutation.previousId) {\n        previous = _this.mirror.getNode(mutation.previousId);\n      }\n      if (mutation.nextId) {\n        next = _this.mirror.getNode(mutation.nextId);\n      }\n      if (nextNotInDOM(mutation)) {\n        return queue.push(mutation);\n      }\n      if (mutation.node.rootId && !_this.mirror.getNode(mutation.node.rootId)) {\n        return;\n      }\n      var targetDoc = mutation.node.rootId ? _this.mirror.getNode(mutation.node.rootId) : _this.iframe.contentDocument;\n      if (isIframeINode(parent)) {\n        _this.attachDocumentToIframe(mutation, parent);\n        return;\n      }\n      var target = buildNodeWithSN(mutation.node, {\n        doc: targetDoc,\n        map: _this.mirror.map,\n        skipChild: true,\n        hackCss: true,\n        cache: _this.cache\n      });\n      if (mutation.previousId === -1 || mutation.nextId === -1) {\n        legacy_missingNodeMap[mutation.node.id] = {\n          node: target,\n          mutation: mutation\n        };\n        return;\n      }\n      if ('__sn' in parent && parent.__sn.type === NodeType.Element && parent.__sn.tagName === 'textarea' && mutation.node.type === NodeType.Text) {\n        try {\n          for (var _d = __values(Array.from(parent.childNodes)), _e = _d.next(); !_e.done; _e = _d.next()) {\n            var c = _e.value;\n            if (c.nodeType === parent.TEXT_NODE) {\n              parent.removeChild(c);\n            }\n          }\n        } catch (e_15_1) {\n          e_15 = {\n            error: e_15_1\n          };\n        } finally {\n          try {\n            if (_e && !_e.done && (_a = _d.return)) _a.call(_d);\n          } finally {\n            if (e_15) throw e_15.error;\n          }\n        }\n      }\n      if (previous && previous.nextSibling && previous.nextSibling.parentNode) {\n        parent.insertBefore(target, previous.nextSibling);\n      } else if (next && next.parentNode) {\n        parent.contains(next) ? parent.insertBefore(target, next) : parent.insertBefore(target, null);\n      } else {\n        if (parent === targetDoc) {\n          while (targetDoc.firstChild) {\n            targetDoc.removeChild(targetDoc.firstChild);\n          }\n        }\n        parent.appendChild(target);\n      }\n      if (isIframeINode(target)) {\n        var mutationInQueue_1 = _this.newDocumentQueue.find(function (m) {\n          return m.parentId === target.__sn.id;\n        });\n        if (mutationInQueue_1) {\n          _this.attachDocumentToIframe(mutationInQueue_1, target);\n          _this.newDocumentQueue = _this.newDocumentQueue.filter(function (m) {\n            return m !== mutationInQueue_1;\n          });\n        }\n      }\n      if (mutation.previousId || mutation.nextId) {\n        _this.legacy_resolveMissingNode(legacy_missingNodeMap, parent, target, mutation);\n      }\n    };\n    d.adds.forEach(function (mutation) {\n      appendNode(mutation);\n    });\n    var startTime = Date.now();\n    while (queue.length) {\n      var resolveTrees = queueToResolveTrees(queue);\n      queue.length = 0;\n      if (Date.now() - startTime > 500) {\n        this.warn('Timeout in the loop, please check the resolve tree data:', resolveTrees);\n        break;\n      }\n      try {\n        for (var resolveTrees_1 = (e_14 = void 0, __values(resolveTrees)), resolveTrees_1_1 = resolveTrees_1.next(); !resolveTrees_1_1.done; resolveTrees_1_1 = resolveTrees_1.next()) {\n          var tree = resolveTrees_1_1.value;\n          var parent_4 = this.mirror.getNode(tree.value.parentId);\n          if (!parent_4) {\n            this.debug('Drop resolve tree since there is no parent for the root node.', tree);\n          } else {\n            iterateResolveTree(tree, function (mutation) {\n              appendNode(mutation);\n            });\n          }\n        }\n      } catch (e_14_1) {\n        e_14 = {\n          error: e_14_1\n        };\n      } finally {\n        try {\n          if (resolveTrees_1_1 && !resolveTrees_1_1.done && (_a = resolveTrees_1.return)) _a.call(resolveTrees_1);\n        } finally {\n          if (e_14) throw e_14.error;\n        }\n      }\n    }\n    if (Object.keys(legacy_missingNodeMap).length) {\n      Object.assign(this.legacy_missingNodeRetryMap, legacy_missingNodeMap);\n    }\n    d.texts.forEach(function (mutation) {\n      var target = _this.mirror.getNode(mutation.id);\n      if (!target) {\n        if (d.removes.find(function (r) {\n          return r.id === mutation.id;\n        })) {\n          return;\n        }\n        return _this.warnNodeNotFound(d, mutation.id);\n      }\n      if (_this.fragmentParentMap.has(target)) {\n        target = _this.fragmentParentMap.get(target);\n      }\n      target.textContent = mutation.value;\n    });\n    d.attributes.forEach(function (mutation) {\n      var target = _this.mirror.getNode(mutation.id);\n      if (!target) {\n        if (d.removes.find(function (r) {\n          return r.id === mutation.id;\n        })) {\n          return;\n        }\n        return _this.warnNodeNotFound(d, mutation.id);\n      }\n      if (_this.fragmentParentMap.has(target)) {\n        target = _this.fragmentParentMap.get(target);\n      }\n      for (var attributeName in mutation.attributes) {\n        if (typeof attributeName === 'string') {\n          var value = mutation.attributes[attributeName];\n          if (value === null) {\n            target.removeAttribute(attributeName);\n          } else if (typeof value === 'string') {\n            try {\n              target.setAttribute(attributeName, value);\n            } catch (error) {\n              if (_this.config.showWarning) {\n                console.warn('An error occurred may due to the checkout feature.', error);\n              }\n            }\n          } else if (attributeName === 'style') {\n            var styleValues = value;\n            var targetEl = target;\n            for (var s in styleValues) {\n              if (styleValues[s] === false) {\n                targetEl.style.removeProperty(s);\n              } else if (styleValues[s] instanceof Array) {\n                var svp = styleValues[s];\n                targetEl.style.setProperty(s, svp[0], svp[1]);\n              } else {\n                var svs = styleValues[s];\n                targetEl.style.setProperty(s, svs);\n              }\n            }\n          }\n        }\n      }\n    });\n  };\n  Replayer.prototype.applyScroll = function (d, isSync) {\n    var target = this.mirror.getNode(d.id);\n    if (!target) {\n      return this.debugNodeNotFound(d, d.id);\n    }\n    if (target === this.iframe.contentDocument) {\n      this.iframe.contentWindow.scrollTo({\n        top: d.y,\n        left: d.x,\n        behavior: isSync ? 'auto' : 'smooth'\n      });\n    } else if (target.__sn.type === NodeType.Document) {\n      target.defaultView.scrollTo({\n        top: d.y,\n        left: d.x,\n        behavior: isSync ? 'auto' : 'smooth'\n      });\n    } else {\n      try {\n        target.scrollTop = d.y;\n        target.scrollLeft = d.x;\n      } catch (error) {}\n    }\n  };\n  Replayer.prototype.applyInput = function (d) {\n    var target = this.mirror.getNode(d.id);\n    if (!target) {\n      return this.debugNodeNotFound(d, d.id);\n    }\n    try {\n      target.checked = d.isChecked;\n      target.value = d.text;\n    } catch (error) {}\n  };\n  Replayer.prototype.applyText = function (d, mutation) {\n    var target = this.mirror.getNode(d.id);\n    if (!target) {\n      return this.debugNodeNotFound(mutation, d.id);\n    }\n    try {\n      target.textContent = d.value;\n    } catch (error) {}\n  };\n  Replayer.prototype.legacy_resolveMissingNode = function (map, parent, target, targetMutation) {\n    var previousId = targetMutation.previousId,\n      nextId = targetMutation.nextId;\n    var previousInMap = previousId && map[previousId];\n    var nextInMap = nextId && map[nextId];\n    if (previousInMap) {\n      var _a = previousInMap,\n        node = _a.node,\n        mutation = _a.mutation;\n      parent.insertBefore(node, target);\n      delete map[mutation.node.id];\n      delete this.legacy_missingNodeRetryMap[mutation.node.id];\n      if (mutation.previousId || mutation.nextId) {\n        this.legacy_resolveMissingNode(map, parent, node, mutation);\n      }\n    }\n    if (nextInMap) {\n      var _b = nextInMap,\n        node = _b.node,\n        mutation = _b.mutation;\n      parent.insertBefore(node, target.nextSibling);\n      delete map[mutation.node.id];\n      delete this.legacy_missingNodeRetryMap[mutation.node.id];\n      if (mutation.previousId || mutation.nextId) {\n        this.legacy_resolveMissingNode(map, parent, node, mutation);\n      }\n    }\n  };\n  Replayer.prototype.moveAndHover = function (x, y, id, isSync, debugData) {\n    var target = this.mirror.getNode(id);\n    if (!target) {\n      return this.debugNodeNotFound(debugData, id);\n    }\n    var base = getBaseDimension(target, this.iframe);\n    var _x = x * base.absoluteScale + base.x;\n    var _y = y * base.absoluteScale + base.y;\n    this.mouse.style.left = \"\".concat(_x, \"px\");\n    this.mouse.style.top = \"\".concat(_y, \"px\");\n    if (!isSync) {\n      this.drawMouseTail({\n        x: _x,\n        y: _y\n      });\n    }\n    this.hoverElements(target);\n  };\n  Replayer.prototype.drawMouseTail = function (position) {\n    var _this = this;\n    if (!this.mouseTail) {\n      return;\n    }\n    var _a = this.config.mouseTail === true ? defaultMouseTailConfig : Object.assign({}, defaultMouseTailConfig, this.config.mouseTail),\n      lineCap = _a.lineCap,\n      lineWidth = _a.lineWidth,\n      strokeStyle = _a.strokeStyle,\n      duration = _a.duration;\n    var draw = function () {\n      if (!_this.mouseTail) {\n        return;\n      }\n      var ctx = _this.mouseTail.getContext('2d');\n      if (!ctx || !_this.tailPositions.length) {\n        return;\n      }\n      ctx.clearRect(0, 0, _this.mouseTail.width, _this.mouseTail.height);\n      ctx.beginPath();\n      ctx.lineWidth = lineWidth;\n      ctx.lineCap = lineCap;\n      ctx.strokeStyle = strokeStyle;\n      ctx.moveTo(_this.tailPositions[0].x, _this.tailPositions[0].y);\n      _this.tailPositions.forEach(function (p) {\n        return ctx.lineTo(p.x, p.y);\n      });\n      ctx.stroke();\n    };\n    this.tailPositions.push(position);\n    draw();\n    setTimeout(function () {\n      _this.tailPositions = _this.tailPositions.filter(function (p) {\n        return p !== position;\n      });\n      draw();\n    }, duration / this.speedService.state.context.timer.speed);\n  };\n  Replayer.prototype.hoverElements = function (el) {\n    var _a;\n    (_a = this.iframe.contentDocument) === null || _a === void 0 ? void 0 : _a.querySelectorAll('.\\\\:hover').forEach(function (hoveredEl) {\n      hoveredEl.classList.remove(':hover');\n    });\n    var currentEl = el;\n    while (currentEl) {\n      if (currentEl.classList) {\n        currentEl.classList.add(':hover');\n      }\n      currentEl = currentEl.parentElement;\n    }\n  };\n  Replayer.prototype.isUserInteraction = function (event) {\n    if (event.type !== EventType.IncrementalSnapshot) {\n      return false;\n    }\n    return event.data.source > IncrementalSource.Mutation && event.data.source <= IncrementalSource.Input;\n  };\n  Replayer.prototype.backToNormal = function () {\n    this.nextUserInteractionEvent = null;\n    if (this.speedService.state.matches('normal')) {\n      return;\n    }\n    this.speedService.send({\n      type: 'BACK_TO_NORMAL'\n    });\n    this.emitter.emit(ReplayerEvents.SkipEnd, {\n      speed: this.speedService.state.context.normalSpeed\n    });\n  };\n  Replayer.prototype.restoreRealParent = function (frag, parent) {\n    this.mirror.map[parent.__sn.id] = parent;\n    if (parent.__sn.type === NodeType.Element && parent.__sn.tagName === 'textarea' && frag.textContent) {\n      parent.value = frag.textContent;\n    }\n    parent.appendChild(frag);\n    this.restoreState(parent);\n  };\n  Replayer.prototype.storeState = function (parent) {\n    var e_16, _a;\n    if (parent) {\n      if (parent.nodeType === parent.ELEMENT_NODE) {\n        var parentElement = parent;\n        if (parentElement.scrollLeft || parentElement.scrollTop) {\n          this.elementStateMap.set(parent, {\n            scroll: [parentElement.scrollLeft, parentElement.scrollTop]\n          });\n        }\n        if (parentElement.tagName === 'STYLE') storeCSSRules(parentElement, this.virtualStyleRulesMap);\n        var children = parentElement.children;\n        try {\n          for (var _b = __values(Array.from(children)), _c = _b.next(); !_c.done; _c = _b.next()) {\n            var child = _c.value;\n            this.storeState(child);\n          }\n        } catch (e_16_1) {\n          e_16 = {\n            error: e_16_1\n          };\n        } finally {\n          try {\n            if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n          } finally {\n            if (e_16) throw e_16.error;\n          }\n        }\n      }\n    }\n  };\n  Replayer.prototype.restoreState = function (parent) {\n    var e_17, _a;\n    if (parent.nodeType === parent.ELEMENT_NODE) {\n      var parentElement = parent;\n      if (this.elementStateMap.has(parent)) {\n        var storedState = this.elementStateMap.get(parent);\n        if (storedState.scroll) {\n          parentElement.scrollLeft = storedState.scroll[0];\n          parentElement.scrollTop = storedState.scroll[1];\n        }\n        this.elementStateMap.delete(parent);\n      }\n      var children = parentElement.children;\n      try {\n        for (var _b = __values(Array.from(children)), _c = _b.next(); !_c.done; _c = _b.next()) {\n          var child = _c.value;\n          this.restoreState(child);\n        }\n      } catch (e_17_1) {\n        e_17 = {\n          error: e_17_1\n        };\n      } finally {\n        try {\n          if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n        } finally {\n          if (e_17) throw e_17.error;\n        }\n      }\n    }\n  };\n  Replayer.prototype.restoreNodeSheet = function (node) {\n    var storedRules = this.virtualStyleRulesMap.get(node);\n    if (node.nodeName !== 'STYLE') {\n      return;\n    }\n    if (!storedRules) {\n      return;\n    }\n    var styleNode = node;\n    applyVirtualStyleRulesToNode(storedRules, styleNode);\n  };\n  Replayer.prototype.warnNodeNotFound = function (d, id) {\n    if (this.treeIndex.idRemoved(id)) {\n      this.warn(\"Node with id '\".concat(id, \"' was previously removed. \"), d);\n    } else {\n      this.warn(\"Node with id '\".concat(id, \"' not found. \"), d);\n    }\n  };\n  Replayer.prototype.warnCanvasMutationFailed = function (d, error) {\n    this.warn(\"Has error on canvas update\", error, 'canvas mutation:', d);\n  };\n  Replayer.prototype.debugNodeNotFound = function (d, id) {\n    if (this.treeIndex.idRemoved(id)) {\n      this.debug(REPLAY_CONSOLE_PREFIX, \"Node with id '\".concat(id, \"' was previously removed. \"), d);\n    } else {\n      this.debug(REPLAY_CONSOLE_PREFIX, \"Node with id '\".concat(id, \"' not found. \"), d);\n    }\n  };\n  Replayer.prototype.warn = function () {\n    var args = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n    if (!this.config.showWarning) {\n      return;\n    }\n    console.warn.apply(console, __spreadArray([REPLAY_CONSOLE_PREFIX], __read(args), false));\n  };\n  Replayer.prototype.debug = function () {\n    var args = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n    if (!this.config.showDebug) {\n      return;\n    }\n    console.log.apply(console, __spreadArray([REPLAY_CONSOLE_PREFIX], __read(args), false));\n  };\n  return Replayer;\n}();\nexport { Replayer };","map":{"version":3,"names":["__values","__spreadArray","__read","__assign","createCache","rebuild","buildNodeWithSN","NodeType","mitt_es","mitt$1","polyfill","Timer","createPlayerService","createSpeedService","ReplayerEvents","EventType","IncrementalSource","MouseInteractions","polyfill$1","isIframeINode","hasShadowRoot","queueToResolveTrees","iterateResolveTree","getBaseDimension","createMirror","TreeIndex","rules","getNestedRule","StyleRuleType","getPositionsAndIndex","storeCSSRules","applyVirtualStyleRulesToNode","canvasMutation","SKIP_TIME_THRESHOLD","SKIP_TIME_INTERVAL","mitt","REPLAY_CONSOLE_PREFIX","defaultMouseTailConfig","duration","lineCap","lineWidth","strokeStyle","indicatesTouchDevice","e","type","IncrementalSnapshot","data","source","TouchMove","MouseInteraction","TouchStart","Replayer","events","config","_this","mouseTail","tailPositions","emitter","legacy_missingNodeRetryMap","cache","imageMap","Map","mirror","firstFullSnapshot","newDocumentQueue","mousePos","touchActive","liveMode","length","Error","defaultConfig","speed","maxSpeed","root","document","body","loadTimeout","skipInactive","showWarning","showDebug","blockClass","insertStyleRules","triggerFocus","UNSAFE_replayCanvas","pauseAnimation","Object","assign","handleResize","bind","getCastFn","applyEventsSynchronously","on","Resize","setupDom","treeIndex","fragmentParentMap","elementStateMap","virtualStyleRulesMap","Flush","e_1","_a","e_2","_b","e_3","_c","e_4","_d","_e","flush","scrollMap","inputMap","mutationData","forEach","parent","frag","restoreRealParent","_f","texts","_g","next","done","d","value","applyText","e_1_1","error","return","call","_h","keys","_j","node","restoreNodeSheet","e_2_1","clear","_k","values","_l","applyScroll","e_3_1","_m","_o","applyInput","e_4_1","PlayBack","reset","timer","service","map","unpackFn","sort","a1","a2","timestamp","timeOffset","baselineTime","lastPlayedEvent","start","subscribe","state","emit","StateChange","player","speedService","normalSpeed","firstMeta","context","find","Meta","firstFullsnapshot","FullSnapshot","width_1","width","height_1","height","setTimeout","rebuildFullSnapshot","iframe","contentWindow","scrollTo","initialOffset","mouse","classList","add","defineProperty","prototype","get","enumerable","configurable","event","handler","off","setConfig","key","backToNormal","send","payload","style","display","createElement","Number","parseFloat","wrapper","insertBefore","getMetaData","firstEvent","lastEvent","startTime","endTime","totalTime","getCurrentTime","getTimeOffset","getMirror","play","matches","contentDocument","getElementsByTagName","remove","Start","pause","undefined","Pause","resume","console","warn","Resume","startLive","addEvent","rawEvent","Promise","resolve","then","enableInteract","setAttribute","pointerEvents","disableInteract","resetCache","appendChild","attributes","push","join","dimension","e_5","el","String","e_5_1","e_6","events_1","events_1_1","event_1","DomContentLoaded","Load","Custom","Plugin","MediaInteraction","castFn","e_6_1","moveAndHover","x","y","id","debugData","isSync","CustomEvent","e_7","applyIncremental","nextUserInteractionEvent","_event","isUserInteraction","delay","e_7_1","skipTime","Math","min","round","SkipStart","wrappedCastFn","e_8","plugins","plugin","replayer","e_8_1","last_index","finish_1","Finish","MouseMove","positions","max","EventCast","e_9","collected","doc","afterAppend","builtNode","collectIframeAndAttachDocument","_loop_1","mutationInQueue","this_1","attachDocumentToIframe","filter","m","collected_1","collected_1_1","e_9_1","documentElement","head","FullsnapshotRebuilded","waitForStylesheetLoad","preloadAllImages","styleEl","injectStylesRules","concat","idx","sheet","insertRule","mutation","iframeEl","e_10","parent_1","parentNode","has","realParent","hackCss","skipChild","__sn","Element","tagName","toUpperCase","_loop_2","this_2","collected_2","collected_2_1","e_10_1","parentId","unloadSheets_1","Set","timer_1","beforeLoadState_1","stateHandler_1","unsubscribe_1","querySelectorAll","css","addEventListener","delete","size","LoadStylesheetEnd","clearTimeout","LoadStylesheetStart","hasImageArg","args","e_11","args_1","args_1_1","arg","rr_type","Array","e_11_1","getImageArgs","e_12","images","args_2","args_2_1","apply","src","e_12_1","e_13","stateHandler","_loop_3","event_2","CanvasMutation","commands","c","preloadImages","this_3","e_13_1","property","canvas","ctx","getContext","imgd","createImageData","JSON","parse","putImageData","url","image","Image","set","Mutation","adds","target","getNode","text","attribute","removes","applyMutation","message","Drag","lastPosition","p","action","doAction","addAction","event_3","Event","toLowerCase","debugNodeNotFound","Blur","blur","Focus","focus","preventScroll","Click","TouchEnd","offsetWidth","TouchCancel","dispatchEvent","Scroll","scroll","ViewportResize","Input","input","mediaEl","currentTime","volume","muted","StyleSheetRule","parent_2","usingVirtualParent_1","styleSheet_1","rules_1","rule","nestedIndex","index","isArray","nestedRule","cssRules","cssText","Insert","Remove","deleteRule","StyleDeclaration","parent_3","usingVirtualParent","styleSheet","setProperty","priority","SetProperty","removeProperty","RemoveProperty","errorHandler","warnCanvasMutationFailed","Font","fontFace","FontFace","family","buffer","Uint8Array","fontSource","descriptors","fonts","useVirtualParent","e_14","r","warnNodeNotFound","isShadow","shadowRoot","removeNodeFromMap","realTarget","contains","removeChild","DOMException","legacy_missingNodeMap","queue","nextNotInDOM","nextId","appendNode","e_15","Document","parentInDocument","hasIframeChild","virtualParent","createDocumentFragment","storeState","firstChild","attachShadow","mode","previous","previousId","rootId","targetDoc","Text","from","childNodes","nodeType","TEXT_NODE","e_15_1","nextSibling","mutationInQueue_1","legacy_resolveMissingNode","Date","now","resolveTrees","resolveTrees_1","resolveTrees_1_1","tree","parent_4","debug","e_14_1","textContent","attributeName","removeAttribute","styleValues","targetEl","s","svp","svs","top","left","behavior","defaultView","scrollTop","scrollLeft","checked","isChecked","targetMutation","previousInMap","nextInMap","base","_x","absoluteScale","_y","drawMouseTail","hoverElements","position","draw","clearRect","beginPath","moveTo","lineTo","stroke","hoveredEl","currentEl","parentElement","SkipEnd","restoreState","e_16","ELEMENT_NODE","children","child","e_16_1","e_17","storedState","e_17_1","storedRules","nodeName","styleNode","idRemoved","_i","arguments","log"],"sources":["C:/Users/PRIYAM/OneDrive/Desktop/session replay/frontend/node_modules/rrweb/es/rrweb/packages/rrweb/src/replay/index.js"],"sourcesContent":["import { __values, __spreadArray, __read, __assign } from '../../ext/tslib/tslib.es6.js';\nimport { createCache, rebuild, buildNodeWithSN, NodeType } from '../../../rrweb-snapshot/es/rrweb-snapshot.js';\nimport * as mitt_es from '../../../../ext/mitt/dist/mitt.es.js';\nimport mitt$1 from '../../../../ext/mitt/dist/mitt.es.js';\nimport { polyfill } from './smoothscroll.js';\nimport { Timer } from './timer.js';\nimport { createPlayerService, createSpeedService } from './machine.js';\nimport { ReplayerEvents, EventType, IncrementalSource, MouseInteractions } from '../types.js';\nimport { polyfill as polyfill$1, isIframeINode, hasShadowRoot, queueToResolveTrees, iterateResolveTree, getBaseDimension, createMirror, TreeIndex } from '../utils.js';\nimport rules from './styles/inject-style.js';\nimport { getNestedRule, StyleRuleType, getPositionsAndIndex, storeCSSRules, applyVirtualStyleRulesToNode } from './virtual-styles.js';\nimport canvasMutation from './canvas/index.js';\n\nvar SKIP_TIME_THRESHOLD = 10 * 1000;\nvar SKIP_TIME_INTERVAL = 5 * 1000;\nvar mitt = mitt$1 || mitt_es;\nvar REPLAY_CONSOLE_PREFIX = '[replayer]';\nvar defaultMouseTailConfig = {\n    duration: 500,\n    lineCap: 'round',\n    lineWidth: 3,\n    strokeStyle: 'red',\n};\nfunction indicatesTouchDevice(e) {\n    return (e.type == EventType.IncrementalSnapshot &&\n        (e.data.source == IncrementalSource.TouchMove ||\n            (e.data.source == IncrementalSource.MouseInteraction &&\n                e.data.type == MouseInteractions.TouchStart)));\n}\nvar Replayer = (function () {\n    function Replayer(events, config) {\n        var _this = this;\n        this.mouseTail = null;\n        this.tailPositions = [];\n        this.emitter = mitt();\n        this.legacy_missingNodeRetryMap = {};\n        this.cache = createCache();\n        this.imageMap = new Map();\n        this.mirror = createMirror();\n        this.firstFullSnapshot = null;\n        this.newDocumentQueue = [];\n        this.mousePos = null;\n        this.touchActive = null;\n        if (!(config === null || config === void 0 ? void 0 : config.liveMode) && events.length < 2) {\n            throw new Error('Replayer need at least 2 events.');\n        }\n        var defaultConfig = {\n            speed: 1,\n            maxSpeed: 360,\n            root: document.body,\n            loadTimeout: 0,\n            skipInactive: false,\n            showWarning: true,\n            showDebug: false,\n            blockClass: 'rr-block',\n            liveMode: false,\n            insertStyleRules: [],\n            triggerFocus: true,\n            UNSAFE_replayCanvas: false,\n            pauseAnimation: true,\n            mouseTail: defaultMouseTailConfig,\n        };\n        this.config = Object.assign({}, defaultConfig, config);\n        this.handleResize = this.handleResize.bind(this);\n        this.getCastFn = this.getCastFn.bind(this);\n        this.applyEventsSynchronously = this.applyEventsSynchronously.bind(this);\n        this.emitter.on(ReplayerEvents.Resize, this.handleResize);\n        this.setupDom();\n        this.treeIndex = new TreeIndex();\n        this.fragmentParentMap = new Map();\n        this.elementStateMap = new Map();\n        this.virtualStyleRulesMap = new Map();\n        this.emitter.on(ReplayerEvents.Flush, function () {\n            var e_1, _a, e_2, _b, e_3, _c, e_4, _d;\n            var _e = _this.treeIndex.flush(), scrollMap = _e.scrollMap, inputMap = _e.inputMap, mutationData = _e.mutationData;\n            _this.fragmentParentMap.forEach(function (parent, frag) {\n                return _this.restoreRealParent(frag, parent);\n            });\n            try {\n                for (var _f = __values(mutationData.texts), _g = _f.next(); !_g.done; _g = _f.next()) {\n                    var d = _g.value;\n                    _this.applyText(d, mutationData);\n                }\n            }\n            catch (e_1_1) { e_1 = { error: e_1_1 }; }\n            finally {\n                try {\n                    if (_g && !_g.done && (_a = _f.return)) _a.call(_f);\n                }\n                finally { if (e_1) throw e_1.error; }\n            }\n            try {\n                for (var _h = __values(_this.virtualStyleRulesMap.keys()), _j = _h.next(); !_j.done; _j = _h.next()) {\n                    var node = _j.value;\n                    _this.restoreNodeSheet(node);\n                }\n            }\n            catch (e_2_1) { e_2 = { error: e_2_1 }; }\n            finally {\n                try {\n                    if (_j && !_j.done && (_b = _h.return)) _b.call(_h);\n                }\n                finally { if (e_2) throw e_2.error; }\n            }\n            _this.fragmentParentMap.clear();\n            _this.elementStateMap.clear();\n            _this.virtualStyleRulesMap.clear();\n            try {\n                for (var _k = __values(scrollMap.values()), _l = _k.next(); !_l.done; _l = _k.next()) {\n                    var d = _l.value;\n                    _this.applyScroll(d, true);\n                }\n            }\n            catch (e_3_1) { e_3 = { error: e_3_1 }; }\n            finally {\n                try {\n                    if (_l && !_l.done && (_c = _k.return)) _c.call(_k);\n                }\n                finally { if (e_3) throw e_3.error; }\n            }\n            try {\n                for (var _m = __values(inputMap.values()), _o = _m.next(); !_o.done; _o = _m.next()) {\n                    var d = _o.value;\n                    _this.applyInput(d);\n                }\n            }\n            catch (e_4_1) { e_4 = { error: e_4_1 }; }\n            finally {\n                try {\n                    if (_o && !_o.done && (_d = _m.return)) _d.call(_m);\n                }\n                finally { if (e_4) throw e_4.error; }\n            }\n        });\n        this.emitter.on(ReplayerEvents.PlayBack, function () {\n            _this.firstFullSnapshot = null;\n            _this.mirror.reset();\n        });\n        var timer = new Timer([], (config === null || config === void 0 ? void 0 : config.speed) || defaultConfig.speed);\n        this.service = createPlayerService({\n            events: events\n                .map(function (e) {\n                if (config && config.unpackFn) {\n                    return config.unpackFn(e);\n                }\n                return e;\n            })\n                .sort(function (a1, a2) { return a1.timestamp - a2.timestamp; }),\n            timer: timer,\n            timeOffset: 0,\n            baselineTime: 0,\n            lastPlayedEvent: null,\n        }, {\n            getCastFn: this.getCastFn,\n            applyEventsSynchronously: this.applyEventsSynchronously,\n            emitter: this.emitter,\n        });\n        this.service.start();\n        this.service.subscribe(function (state) {\n            _this.emitter.emit(ReplayerEvents.StateChange, {\n                player: state,\n            });\n        });\n        this.speedService = createSpeedService({\n            normalSpeed: -1,\n            timer: timer,\n        });\n        this.speedService.start();\n        this.speedService.subscribe(function (state) {\n            _this.emitter.emit(ReplayerEvents.StateChange, {\n                speed: state,\n            });\n        });\n        var firstMeta = this.service.state.context.events.find(function (e) { return e.type === EventType.Meta; });\n        var firstFullsnapshot = this.service.state.context.events.find(function (e) { return e.type === EventType.FullSnapshot; });\n        if (firstMeta) {\n            var _a = firstMeta.data, width_1 = _a.width, height_1 = _a.height;\n            setTimeout(function () {\n                _this.emitter.emit(ReplayerEvents.Resize, {\n                    width: width_1,\n                    height: height_1,\n                });\n            }, 0);\n        }\n        if (firstFullsnapshot) {\n            setTimeout(function () {\n                if (_this.firstFullSnapshot) {\n                    return;\n                }\n                _this.firstFullSnapshot = firstFullsnapshot;\n                _this.rebuildFullSnapshot(firstFullsnapshot);\n                _this.iframe.contentWindow.scrollTo(firstFullsnapshot.data.initialOffset);\n            }, 1);\n        }\n        if (this.service.state.context.events.find(indicatesTouchDevice)) {\n            this.mouse.classList.add('touch-device');\n        }\n    }\n    Object.defineProperty(Replayer.prototype, \"timer\", {\n        get: function () {\n            return this.service.state.context.timer;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Replayer.prototype.on = function (event, handler) {\n        this.emitter.on(event, handler);\n        return this;\n    };\n    Replayer.prototype.off = function (event, handler) {\n        this.emitter.off(event, handler);\n        return this;\n    };\n    Replayer.prototype.setConfig = function (config) {\n        var _this = this;\n        Object.keys(config).forEach(function (key) {\n            _this.config[key] = config[key];\n        });\n        if (!this.config.skipInactive) {\n            this.backToNormal();\n        }\n        if (typeof config.speed !== 'undefined') {\n            this.speedService.send({\n                type: 'SET_SPEED',\n                payload: {\n                    speed: config.speed,\n                },\n            });\n        }\n        if (typeof config.mouseTail !== 'undefined') {\n            if (config.mouseTail === false) {\n                if (this.mouseTail) {\n                    this.mouseTail.style.display = 'none';\n                }\n            }\n            else {\n                if (!this.mouseTail) {\n                    this.mouseTail = document.createElement('canvas');\n                    this.mouseTail.width = Number.parseFloat(this.iframe.width);\n                    this.mouseTail.height = Number.parseFloat(this.iframe.height);\n                    this.mouseTail.classList.add('replayer-mouse-tail');\n                    this.wrapper.insertBefore(this.mouseTail, this.iframe);\n                }\n                this.mouseTail.style.display = 'inherit';\n            }\n        }\n    };\n    Replayer.prototype.getMetaData = function () {\n        var firstEvent = this.service.state.context.events[0];\n        var lastEvent = this.service.state.context.events[this.service.state.context.events.length - 1];\n        return {\n            startTime: firstEvent.timestamp,\n            endTime: lastEvent.timestamp,\n            totalTime: lastEvent.timestamp - firstEvent.timestamp,\n        };\n    };\n    Replayer.prototype.getCurrentTime = function () {\n        return this.timer.timeOffset + this.getTimeOffset();\n    };\n    Replayer.prototype.getTimeOffset = function () {\n        var _a = this.service.state.context, baselineTime = _a.baselineTime, events = _a.events;\n        return baselineTime - events[0].timestamp;\n    };\n    Replayer.prototype.getMirror = function () {\n        return this.mirror;\n    };\n    Replayer.prototype.play = function (timeOffset) {\n        var _a;\n        if (timeOffset === void 0) { timeOffset = 0; }\n        if (this.service.state.matches('paused')) {\n            this.service.send({ type: 'PLAY', payload: { timeOffset: timeOffset } });\n        }\n        else {\n            this.service.send({ type: 'PAUSE' });\n            this.service.send({ type: 'PLAY', payload: { timeOffset: timeOffset } });\n        }\n        (_a = this.iframe.contentDocument) === null || _a === void 0 ? void 0 : _a.getElementsByTagName('html')[0].classList.remove('rrweb-paused');\n        this.emitter.emit(ReplayerEvents.Start);\n    };\n    Replayer.prototype.pause = function (timeOffset) {\n        var _a;\n        if (timeOffset === undefined && this.service.state.matches('playing')) {\n            this.service.send({ type: 'PAUSE' });\n        }\n        if (typeof timeOffset === 'number') {\n            this.play(timeOffset);\n            this.service.send({ type: 'PAUSE' });\n        }\n        (_a = this.iframe.contentDocument) === null || _a === void 0 ? void 0 : _a.getElementsByTagName('html')[0].classList.add('rrweb-paused');\n        this.emitter.emit(ReplayerEvents.Pause);\n    };\n    Replayer.prototype.resume = function (timeOffset) {\n        if (timeOffset === void 0) { timeOffset = 0; }\n        console.warn(\"The 'resume' will be departed in 1.0. Please use 'play' method which has the same interface.\");\n        this.play(timeOffset);\n        this.emitter.emit(ReplayerEvents.Resume);\n    };\n    Replayer.prototype.startLive = function (baselineTime) {\n        this.service.send({ type: 'TO_LIVE', payload: { baselineTime: baselineTime } });\n    };\n    Replayer.prototype.addEvent = function (rawEvent) {\n        var _this = this;\n        var event = this.config.unpackFn\n            ? this.config.unpackFn(rawEvent)\n            : rawEvent;\n        if (indicatesTouchDevice(event)) {\n            this.mouse.classList.add('touch-device');\n        }\n        Promise.resolve().then(function () {\n            return _this.service.send({ type: 'ADD_EVENT', payload: { event: event } });\n        });\n    };\n    Replayer.prototype.enableInteract = function () {\n        this.iframe.setAttribute('scrolling', 'auto');\n        this.iframe.style.pointerEvents = 'auto';\n    };\n    Replayer.prototype.disableInteract = function () {\n        this.iframe.setAttribute('scrolling', 'no');\n        this.iframe.style.pointerEvents = 'none';\n    };\n    Replayer.prototype.resetCache = function () {\n        this.cache = createCache();\n    };\n    Replayer.prototype.setupDom = function () {\n        this.wrapper = document.createElement('div');\n        this.wrapper.classList.add('replayer-wrapper');\n        this.config.root.appendChild(this.wrapper);\n        this.mouse = document.createElement('div');\n        this.mouse.classList.add('replayer-mouse');\n        this.wrapper.appendChild(this.mouse);\n        if (this.config.mouseTail !== false) {\n            this.mouseTail = document.createElement('canvas');\n            this.mouseTail.classList.add('replayer-mouse-tail');\n            this.mouseTail.style.display = 'inherit';\n            this.wrapper.appendChild(this.mouseTail);\n        }\n        this.iframe = document.createElement('iframe');\n        var attributes = ['allow-same-origin'];\n        if (this.config.UNSAFE_replayCanvas) {\n            attributes.push('allow-scripts');\n        }\n        this.iframe.style.display = 'none';\n        this.iframe.setAttribute('sandbox', attributes.join(' '));\n        this.disableInteract();\n        this.wrapper.appendChild(this.iframe);\n        if (this.iframe.contentWindow && this.iframe.contentDocument) {\n            polyfill(this.iframe.contentWindow, this.iframe.contentDocument);\n            polyfill$1(this.iframe.contentWindow);\n        }\n    };\n    Replayer.prototype.handleResize = function (dimension) {\n        var e_5, _a;\n        this.iframe.style.display = 'inherit';\n        try {\n            for (var _b = __values([this.mouseTail, this.iframe]), _c = _b.next(); !_c.done; _c = _b.next()) {\n                var el = _c.value;\n                if (!el) {\n                    continue;\n                }\n                el.setAttribute('width', String(dimension.width));\n                el.setAttribute('height', String(dimension.height));\n            }\n        }\n        catch (e_5_1) { e_5 = { error: e_5_1 }; }\n        finally {\n            try {\n                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n            }\n            finally { if (e_5) throw e_5.error; }\n        }\n    };\n    Replayer.prototype.applyEventsSynchronously = function (events) {\n        var e_6, _a;\n        try {\n            for (var events_1 = __values(events), events_1_1 = events_1.next(); !events_1_1.done; events_1_1 = events_1.next()) {\n                var event_1 = events_1_1.value;\n                switch (event_1.type) {\n                    case EventType.DomContentLoaded:\n                    case EventType.Load:\n                    case EventType.Custom:\n                        continue;\n                    case EventType.FullSnapshot:\n                    case EventType.Meta:\n                    case EventType.Plugin:\n                        break;\n                    case EventType.IncrementalSnapshot:\n                        switch (event_1.data.source) {\n                            case IncrementalSource.MediaInteraction:\n                                continue;\n                            default:\n                                break;\n                        }\n                        break;\n                    default:\n                        break;\n                }\n                var castFn = this.getCastFn(event_1, true);\n                castFn();\n            }\n        }\n        catch (e_6_1) { e_6 = { error: e_6_1 }; }\n        finally {\n            try {\n                if (events_1_1 && !events_1_1.done && (_a = events_1.return)) _a.call(events_1);\n            }\n            finally { if (e_6) throw e_6.error; }\n        }\n        if (this.mousePos) {\n            this.moveAndHover(this.mousePos.x, this.mousePos.y, this.mousePos.id, true, this.mousePos.debugData);\n        }\n        this.mousePos = null;\n        if (this.touchActive === true) {\n            this.mouse.classList.add('touch-active');\n        }\n        else if (this.touchActive === false) {\n            this.mouse.classList.remove('touch-active');\n        }\n        this.touchActive = null;\n    };\n    Replayer.prototype.getCastFn = function (event, isSync) {\n        var _this = this;\n        if (isSync === void 0) { isSync = false; }\n        var castFn;\n        switch (event.type) {\n            case EventType.DomContentLoaded:\n            case EventType.Load:\n                break;\n            case EventType.Custom:\n                castFn = function () {\n                    _this.emitter.emit(ReplayerEvents.CustomEvent, event);\n                };\n                break;\n            case EventType.Meta:\n                castFn = function () {\n                    return _this.emitter.emit(ReplayerEvents.Resize, {\n                        width: event.data.width,\n                        height: event.data.height,\n                    });\n                };\n                break;\n            case EventType.FullSnapshot:\n                castFn = function () {\n                    if (_this.firstFullSnapshot) {\n                        if (_this.firstFullSnapshot === event) {\n                            _this.firstFullSnapshot = true;\n                            return;\n                        }\n                    }\n                    else {\n                        _this.firstFullSnapshot = true;\n                    }\n                    _this.rebuildFullSnapshot(event, isSync);\n                    _this.iframe.contentWindow.scrollTo(event.data.initialOffset);\n                };\n                break;\n            case EventType.IncrementalSnapshot:\n                castFn = function () {\n                    var e_7, _a;\n                    _this.applyIncremental(event, isSync);\n                    if (isSync) {\n                        return;\n                    }\n                    if (event === _this.nextUserInteractionEvent) {\n                        _this.nextUserInteractionEvent = null;\n                        _this.backToNormal();\n                    }\n                    if (_this.config.skipInactive && !_this.nextUserInteractionEvent) {\n                        try {\n                            for (var _b = __values(_this.service.state.context.events), _c = _b.next(); !_c.done; _c = _b.next()) {\n                                var _event = _c.value;\n                                if (_event.timestamp <= event.timestamp) {\n                                    continue;\n                                }\n                                if (_this.isUserInteraction(_event)) {\n                                    if (_event.delay - event.delay >\n                                        SKIP_TIME_THRESHOLD *\n                                            _this.speedService.state.context.timer.speed) {\n                                        _this.nextUserInteractionEvent = _event;\n                                    }\n                                    break;\n                                }\n                            }\n                        }\n                        catch (e_7_1) { e_7 = { error: e_7_1 }; }\n                        finally {\n                            try {\n                                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n                            }\n                            finally { if (e_7) throw e_7.error; }\n                        }\n                        if (_this.nextUserInteractionEvent) {\n                            var skipTime = _this.nextUserInteractionEvent.delay - event.delay;\n                            var payload = {\n                                speed: Math.min(Math.round(skipTime / SKIP_TIME_INTERVAL), _this.config.maxSpeed),\n                            };\n                            _this.speedService.send({ type: 'FAST_FORWARD', payload: payload });\n                            _this.emitter.emit(ReplayerEvents.SkipStart, payload);\n                        }\n                    }\n                };\n                break;\n        }\n        var wrappedCastFn = function () {\n            var e_8, _a;\n            if (castFn) {\n                castFn();\n            }\n            try {\n                for (var _b = __values(_this.config.plugins || []), _c = _b.next(); !_c.done; _c = _b.next()) {\n                    var plugin = _c.value;\n                    plugin.handler(event, isSync, { replayer: _this });\n                }\n            }\n            catch (e_8_1) { e_8 = { error: e_8_1 }; }\n            finally {\n                try {\n                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n                }\n                finally { if (e_8) throw e_8.error; }\n            }\n            _this.service.send({ type: 'CAST_EVENT', payload: { event: event } });\n            var last_index = _this.service.state.context.events.length - 1;\n            if (event === _this.service.state.context.events[last_index]) {\n                var finish_1 = function () {\n                    if (last_index < _this.service.state.context.events.length - 1) {\n                        return;\n                    }\n                    _this.backToNormal();\n                    _this.service.send('END');\n                    _this.emitter.emit(ReplayerEvents.Finish);\n                };\n                if (event.type === EventType.IncrementalSnapshot &&\n                    event.data.source === IncrementalSource.MouseMove &&\n                    event.data.positions.length) {\n                    setTimeout(function () {\n                        finish_1();\n                    }, Math.max(0, -event.data.positions[0].timeOffset + 50));\n                }\n                else {\n                    finish_1();\n                }\n            }\n            _this.emitter.emit(ReplayerEvents.EventCast, event);\n        };\n        return wrappedCastFn;\n    };\n    Replayer.prototype.rebuildFullSnapshot = function (event, isSync) {\n        var e_9, _a;\n        var _this = this;\n        if (isSync === void 0) { isSync = false; }\n        if (!this.iframe.contentDocument) {\n            return console.warn('Looks like your replayer has been destroyed.');\n        }\n        if (Object.keys(this.legacy_missingNodeRetryMap).length) {\n            console.warn('Found unresolved missing node map', this.legacy_missingNodeRetryMap);\n        }\n        this.legacy_missingNodeRetryMap = {};\n        var collected = [];\n        this.mirror.map = rebuild(event.data.node, {\n            doc: this.iframe.contentDocument,\n            afterAppend: function (builtNode) {\n                _this.collectIframeAndAttachDocument(collected, builtNode);\n            },\n            cache: this.cache,\n        })[1];\n        var _loop_1 = function (mutationInQueue, builtNode) {\n            this_1.attachDocumentToIframe(mutationInQueue, builtNode);\n            this_1.newDocumentQueue = this_1.newDocumentQueue.filter(function (m) { return m !== mutationInQueue; });\n        };\n        var this_1 = this;\n        try {\n            for (var collected_1 = __values(collected), collected_1_1 = collected_1.next(); !collected_1_1.done; collected_1_1 = collected_1.next()) {\n                var _b = collected_1_1.value, mutationInQueue = _b.mutationInQueue, builtNode = _b.builtNode;\n                _loop_1(mutationInQueue, builtNode);\n            }\n        }\n        catch (e_9_1) { e_9 = { error: e_9_1 }; }\n        finally {\n            try {\n                if (collected_1_1 && !collected_1_1.done && (_a = collected_1.return)) _a.call(collected_1);\n            }\n            finally { if (e_9) throw e_9.error; }\n        }\n        var _c = this.iframe.contentDocument, documentElement = _c.documentElement, head = _c.head;\n        this.insertStyleRules(documentElement, head);\n        if (!this.service.state.matches('playing')) {\n            this.iframe.contentDocument\n                .getElementsByTagName('html')[0]\n                .classList.add('rrweb-paused');\n        }\n        this.emitter.emit(ReplayerEvents.FullsnapshotRebuilded, event);\n        if (!isSync) {\n            this.waitForStylesheetLoad();\n        }\n        if (this.config.UNSAFE_replayCanvas) {\n            this.preloadAllImages();\n        }\n    };\n    Replayer.prototype.insertStyleRules = function (documentElement, head) {\n        var styleEl = document.createElement('style');\n        documentElement.insertBefore(styleEl, head);\n        var injectStylesRules = rules(this.config.blockClass).concat(this.config.insertStyleRules);\n        if (this.config.pauseAnimation) {\n            injectStylesRules.push('html.rrweb-paused *, html.rrweb-paused *:before, html.rrweb-paused *:after { animation-play-state: paused !important; }');\n        }\n        for (var idx = 0; idx < injectStylesRules.length; idx++) {\n            styleEl.sheet.insertRule(injectStylesRules[idx], idx);\n        }\n    };\n    Replayer.prototype.attachDocumentToIframe = function (mutation, iframeEl) {\n        var e_10, _a;\n        var _this = this;\n        var collected = [];\n        if (!iframeEl.contentDocument) {\n            var parent_1 = iframeEl.parentNode;\n            while (parent_1) {\n                if (this.fragmentParentMap.has(parent_1)) {\n                    var frag = parent_1;\n                    var realParent = this.fragmentParentMap.get(frag);\n                    this.restoreRealParent(frag, realParent);\n                    break;\n                }\n                parent_1 = parent_1.parentNode;\n            }\n        }\n        buildNodeWithSN(mutation.node, {\n            doc: iframeEl.contentDocument,\n            map: this.mirror.map,\n            hackCss: true,\n            skipChild: false,\n            afterAppend: function (builtNode) {\n                _this.collectIframeAndAttachDocument(collected, builtNode);\n                if (builtNode.__sn.type === NodeType.Element &&\n                    builtNode.__sn.tagName.toUpperCase() === 'HTML') {\n                    var _a = iframeEl.contentDocument, documentElement = _a.documentElement, head = _a.head;\n                    _this.insertStyleRules(documentElement, head);\n                }\n            },\n            cache: this.cache,\n        });\n        var _loop_2 = function (mutationInQueue, builtNode) {\n            this_2.attachDocumentToIframe(mutationInQueue, builtNode);\n            this_2.newDocumentQueue = this_2.newDocumentQueue.filter(function (m) { return m !== mutationInQueue; });\n        };\n        var this_2 = this;\n        try {\n            for (var collected_2 = __values(collected), collected_2_1 = collected_2.next(); !collected_2_1.done; collected_2_1 = collected_2.next()) {\n                var _b = collected_2_1.value, mutationInQueue = _b.mutationInQueue, builtNode = _b.builtNode;\n                _loop_2(mutationInQueue, builtNode);\n            }\n        }\n        catch (e_10_1) { e_10 = { error: e_10_1 }; }\n        finally {\n            try {\n                if (collected_2_1 && !collected_2_1.done && (_a = collected_2.return)) _a.call(collected_2);\n            }\n            finally { if (e_10) throw e_10.error; }\n        }\n    };\n    Replayer.prototype.collectIframeAndAttachDocument = function (collected, builtNode) {\n        if (isIframeINode(builtNode)) {\n            var mutationInQueue = this.newDocumentQueue.find(function (m) { return m.parentId === builtNode.__sn.id; });\n            if (mutationInQueue) {\n                collected.push({ mutationInQueue: mutationInQueue, builtNode: builtNode });\n            }\n        }\n    };\n    Replayer.prototype.waitForStylesheetLoad = function () {\n        var _this = this;\n        var _a;\n        var head = (_a = this.iframe.contentDocument) === null || _a === void 0 ? void 0 : _a.head;\n        if (head) {\n            var unloadSheets_1 = new Set();\n            var timer_1;\n            var beforeLoadState_1 = this.service.state;\n            var stateHandler_1 = function () {\n                beforeLoadState_1 = _this.service.state;\n            };\n            this.emitter.on(ReplayerEvents.Start, stateHandler_1);\n            this.emitter.on(ReplayerEvents.Pause, stateHandler_1);\n            var unsubscribe_1 = function () {\n                _this.emitter.off(ReplayerEvents.Start, stateHandler_1);\n                _this.emitter.off(ReplayerEvents.Pause, stateHandler_1);\n            };\n            head\n                .querySelectorAll('link[rel=\"stylesheet\"]')\n                .forEach(function (css) {\n                if (!css.sheet) {\n                    unloadSheets_1.add(css);\n                    css.addEventListener('load', function () {\n                        unloadSheets_1.delete(css);\n                        if (unloadSheets_1.size === 0 && timer_1 !== -1) {\n                            if (beforeLoadState_1.matches('playing')) {\n                                _this.play(_this.getCurrentTime());\n                            }\n                            _this.emitter.emit(ReplayerEvents.LoadStylesheetEnd);\n                            if (timer_1) {\n                                clearTimeout(timer_1);\n                            }\n                            unsubscribe_1();\n                        }\n                    });\n                }\n            });\n            if (unloadSheets_1.size > 0) {\n                this.service.send({ type: 'PAUSE' });\n                this.emitter.emit(ReplayerEvents.LoadStylesheetStart);\n                timer_1 = setTimeout(function () {\n                    if (beforeLoadState_1.matches('playing')) {\n                        _this.play(_this.getCurrentTime());\n                    }\n                    timer_1 = -1;\n                    unsubscribe_1();\n                }, this.config.loadTimeout);\n            }\n        }\n    };\n    Replayer.prototype.hasImageArg = function (args) {\n        var e_11, _a;\n        try {\n            for (var args_1 = __values(args), args_1_1 = args_1.next(); !args_1_1.done; args_1_1 = args_1.next()) {\n                var arg = args_1_1.value;\n                if (!arg || typeof arg !== 'object') {\n                }\n                else if ('rr_type' in arg && 'args' in arg) {\n                    if (this.hasImageArg(arg.args))\n                        return true;\n                }\n                else if ('rr_type' in arg && arg.rr_type === 'HTMLImageElement') {\n                    return true;\n                }\n                else if (arg instanceof Array) {\n                    if (this.hasImageArg(arg))\n                        return true;\n                }\n            }\n        }\n        catch (e_11_1) { e_11 = { error: e_11_1 }; }\n        finally {\n            try {\n                if (args_1_1 && !args_1_1.done && (_a = args_1.return)) _a.call(args_1);\n            }\n            finally { if (e_11) throw e_11.error; }\n        }\n        return false;\n    };\n    Replayer.prototype.getImageArgs = function (args) {\n        var e_12, _a;\n        var images = [];\n        try {\n            for (var args_2 = __values(args), args_2_1 = args_2.next(); !args_2_1.done; args_2_1 = args_2.next()) {\n                var arg = args_2_1.value;\n                if (!arg || typeof arg !== 'object') {\n                }\n                else if ('rr_type' in arg && 'args' in arg) {\n                    images.push.apply(images, __spreadArray([], __read(this.getImageArgs(arg.args)), false));\n                }\n                else if ('rr_type' in arg && arg.rr_type === 'HTMLImageElement') {\n                    images.push(arg.src);\n                }\n                else if (arg instanceof Array) {\n                    images.push.apply(images, __spreadArray([], __read(this.getImageArgs(arg)), false));\n                }\n            }\n        }\n        catch (e_12_1) { e_12 = { error: e_12_1 }; }\n        finally {\n            try {\n                if (args_2_1 && !args_2_1.done && (_a = args_2.return)) _a.call(args_2);\n            }\n            finally { if (e_12) throw e_12.error; }\n        }\n        return images;\n    };\n    Replayer.prototype.preloadAllImages = function () {\n        var e_13, _a;\n        var _this = this;\n        this.service.state;\n        var stateHandler = function () {\n            _this.service.state;\n        };\n        this.emitter.on(ReplayerEvents.Start, stateHandler);\n        this.emitter.on(ReplayerEvents.Pause, stateHandler);\n        var _loop_3 = function (event_2) {\n            if (event_2.type === EventType.IncrementalSnapshot &&\n                event_2.data.source === IncrementalSource.CanvasMutation)\n                if ('commands' in event_2.data) {\n                    event_2.data.commands.forEach(function (c) { return _this.preloadImages(c, event_2); });\n                }\n                else {\n                    this_3.preloadImages(event_2.data, event_2);\n                }\n        };\n        var this_3 = this;\n        try {\n            for (var _b = __values(this.service.state.context.events), _c = _b.next(); !_c.done; _c = _b.next()) {\n                var event_2 = _c.value;\n                _loop_3(event_2);\n            }\n        }\n        catch (e_13_1) { e_13 = { error: e_13_1 }; }\n        finally {\n            try {\n                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n            }\n            finally { if (e_13) throw e_13.error; }\n        }\n    };\n    Replayer.prototype.preloadImages = function (data, event) {\n        var _this = this;\n        if (data.property === 'drawImage' &&\n            typeof data.args[0] === 'string' &&\n            !this.imageMap.has(event)) {\n            var canvas = document.createElement('canvas');\n            var ctx = canvas.getContext('2d');\n            var imgd = ctx === null || ctx === void 0 ? void 0 : ctx.createImageData(canvas.width, canvas.height);\n            imgd === null || imgd === void 0 ? void 0 : imgd.data;\n            JSON.parse(data.args[0]);\n            ctx === null || ctx === void 0 ? void 0 : ctx.putImageData(imgd, 0, 0);\n        }\n        else if (this.hasImageArg(data.args)) {\n            this.getImageArgs(data.args).forEach(function (url) {\n                var image = new Image();\n                image.src = url;\n                _this.imageMap.set(url, image);\n            });\n        }\n    };\n    Replayer.prototype.applyIncremental = function (e, isSync) {\n        var _this = this;\n        var _a, _b;\n        var d = e.data;\n        switch (d.source) {\n            case IncrementalSource.Mutation: {\n                if (isSync) {\n                    d.adds.forEach(function (m) { return _this.treeIndex.add(m); });\n                    d.texts.forEach(function (m) {\n                        var target = _this.mirror.getNode(m.id);\n                        var parent = target === null || target === void 0 ? void 0 : target.parentNode;\n                        if (parent && _this.virtualStyleRulesMap.has(parent))\n                            _this.virtualStyleRulesMap.delete(parent);\n                        _this.treeIndex.text(m);\n                    });\n                    d.attributes.forEach(function (m) { return _this.treeIndex.attribute(m); });\n                    d.removes.forEach(function (m) { return _this.treeIndex.remove(m, _this.mirror); });\n                }\n                try {\n                    this.applyMutation(d, isSync);\n                }\n                catch (error) {\n                    this.warn(\"Exception in mutation \".concat(error.message || error), d);\n                }\n                break;\n            }\n            case IncrementalSource.Drag:\n            case IncrementalSource.TouchMove:\n            case IncrementalSource.MouseMove:\n                if (isSync) {\n                    var lastPosition = d.positions[d.positions.length - 1];\n                    this.mousePos = {\n                        x: lastPosition.x,\n                        y: lastPosition.y,\n                        id: lastPosition.id,\n                        debugData: d,\n                    };\n                }\n                else {\n                    d.positions.forEach(function (p) {\n                        var action = {\n                            doAction: function () {\n                                _this.moveAndHover(p.x, p.y, p.id, isSync, d);\n                            },\n                            delay: p.timeOffset +\n                                e.timestamp -\n                                _this.service.state.context.baselineTime,\n                        };\n                        _this.timer.addAction(action);\n                    });\n                    this.timer.addAction({\n                        doAction: function () { },\n                        delay: e.delay - ((_a = d.positions[0]) === null || _a === void 0 ? void 0 : _a.timeOffset),\n                    });\n                }\n                break;\n            case IncrementalSource.MouseInteraction: {\n                if (d.id === -1) {\n                    break;\n                }\n                var event_3 = new Event(MouseInteractions[d.type].toLowerCase());\n                var target = this.mirror.getNode(d.id);\n                if (!target) {\n                    return this.debugNodeNotFound(d, d.id);\n                }\n                this.emitter.emit(ReplayerEvents.MouseInteraction, {\n                    type: d.type,\n                    target: target,\n                });\n                var triggerFocus = this.config.triggerFocus;\n                switch (d.type) {\n                    case MouseInteractions.Blur:\n                        if ('blur' in target) {\n                            target.blur();\n                        }\n                        break;\n                    case MouseInteractions.Focus:\n                        if (triggerFocus && target.focus) {\n                            target.focus({\n                                preventScroll: true,\n                            });\n                        }\n                        break;\n                    case MouseInteractions.Click:\n                    case MouseInteractions.TouchStart:\n                    case MouseInteractions.TouchEnd:\n                        if (isSync) {\n                            if (d.type === MouseInteractions.TouchStart) {\n                                this.touchActive = true;\n                            }\n                            else if (d.type === MouseInteractions.TouchEnd) {\n                                this.touchActive = false;\n                            }\n                            this.mousePos = {\n                                x: d.x,\n                                y: d.y,\n                                id: d.id,\n                                debugData: d,\n                            };\n                        }\n                        else {\n                            if (d.type === MouseInteractions.TouchStart) {\n                                this.tailPositions.length = 0;\n                            }\n                            this.moveAndHover(d.x, d.y, d.id, isSync, d);\n                            if (d.type === MouseInteractions.Click) {\n                                this.mouse.classList.remove('active');\n                                void this.mouse.offsetWidth;\n                                this.mouse.classList.add('active');\n                            }\n                            else if (d.type === MouseInteractions.TouchStart) {\n                                void this.mouse.offsetWidth;\n                                this.mouse.classList.add('touch-active');\n                            }\n                            else if (d.type === MouseInteractions.TouchEnd) {\n                                this.mouse.classList.remove('touch-active');\n                            }\n                        }\n                        break;\n                    case MouseInteractions.TouchCancel:\n                        if (isSync) {\n                            this.touchActive = false;\n                        }\n                        else {\n                            this.mouse.classList.remove('touch-active');\n                        }\n                        break;\n                    default:\n                        target.dispatchEvent(event_3);\n                }\n                break;\n            }\n            case IncrementalSource.Scroll: {\n                if (d.id === -1) {\n                    break;\n                }\n                if (isSync) {\n                    this.treeIndex.scroll(d);\n                    break;\n                }\n                this.applyScroll(d, false);\n                break;\n            }\n            case IncrementalSource.ViewportResize:\n                this.emitter.emit(ReplayerEvents.Resize, {\n                    width: d.width,\n                    height: d.height,\n                });\n                break;\n            case IncrementalSource.Input: {\n                if (d.id === -1) {\n                    break;\n                }\n                if (isSync) {\n                    this.treeIndex.input(d);\n                    break;\n                }\n                this.applyInput(d);\n                break;\n            }\n            case IncrementalSource.MediaInteraction: {\n                var target = this.mirror.getNode(d.id);\n                if (!target) {\n                    return this.debugNodeNotFound(d, d.id);\n                }\n                var mediaEl = target;\n                try {\n                    if (d.currentTime) {\n                        mediaEl.currentTime = d.currentTime;\n                    }\n                    if (d.volume) {\n                        mediaEl.volume = d.volume;\n                    }\n                    if (d.muted) {\n                        mediaEl.muted = d.muted;\n                    }\n                    if (d.type === 1) {\n                        mediaEl.pause();\n                    }\n                    if (d.type === 0) {\n                        mediaEl.play();\n                    }\n                }\n                catch (error) {\n                    if (this.config.showWarning) {\n                        console.warn(\"Failed to replay media interactions: \".concat(error.message || error));\n                    }\n                }\n                break;\n            }\n            case IncrementalSource.StyleSheetRule: {\n                var target = this.mirror.getNode(d.id);\n                if (!target) {\n                    return this.debugNodeNotFound(d, d.id);\n                }\n                var styleEl = target;\n                var parent_2 = target.parentNode;\n                var usingVirtualParent_1 = this.fragmentParentMap.has(parent_2);\n                var styleSheet_1 = usingVirtualParent_1 ? null : styleEl.sheet;\n                var rules_1;\n                if (!styleSheet_1) {\n                    if (this.virtualStyleRulesMap.has(target)) {\n                        rules_1 = this.virtualStyleRulesMap.get(target);\n                    }\n                    else {\n                        rules_1 = [];\n                        this.virtualStyleRulesMap.set(target, rules_1);\n                    }\n                }\n                if (d.adds) {\n                    d.adds.forEach(function (_a) {\n                        var rule = _a.rule, nestedIndex = _a.index;\n                        if (styleSheet_1) {\n                            try {\n                                if (Array.isArray(nestedIndex)) {\n                                    var _b = getPositionsAndIndex(nestedIndex), positions = _b.positions, index = _b.index;\n                                    var nestedRule = getNestedRule(styleSheet_1.cssRules, positions);\n                                    nestedRule.insertRule(rule, index);\n                                }\n                                else {\n                                    var index = nestedIndex === undefined\n                                        ? undefined\n                                        : Math.min(nestedIndex, styleSheet_1.cssRules.length);\n                                    styleSheet_1.insertRule(rule, index);\n                                }\n                            }\n                            catch (e) {\n                            }\n                        }\n                        else {\n                            rules_1 === null || rules_1 === void 0 ? void 0 : rules_1.push({\n                                cssText: rule,\n                                index: nestedIndex,\n                                type: StyleRuleType.Insert,\n                            });\n                        }\n                    });\n                }\n                if (d.removes) {\n                    d.removes.forEach(function (_a) {\n                        var nestedIndex = _a.index;\n                        if (usingVirtualParent_1) {\n                            rules_1 === null || rules_1 === void 0 ? void 0 : rules_1.push({ index: nestedIndex, type: StyleRuleType.Remove });\n                        }\n                        else {\n                            try {\n                                if (Array.isArray(nestedIndex)) {\n                                    var _b = getPositionsAndIndex(nestedIndex), positions = _b.positions, index = _b.index;\n                                    var nestedRule = getNestedRule(styleSheet_1.cssRules, positions);\n                                    nestedRule.deleteRule(index || 0);\n                                }\n                                else {\n                                    styleSheet_1 === null || styleSheet_1 === void 0 ? void 0 : styleSheet_1.deleteRule(nestedIndex);\n                                }\n                            }\n                            catch (e) {\n                            }\n                        }\n                    });\n                }\n                break;\n            }\n            case IncrementalSource.StyleDeclaration: {\n                var target = this.mirror.getNode(d.id);\n                if (!target) {\n                    return this.debugNodeNotFound(d, d.id);\n                }\n                var styleEl = target;\n                var parent_3 = target.parentNode;\n                var usingVirtualParent = this.fragmentParentMap.has(parent_3);\n                var styleSheet = usingVirtualParent ? null : styleEl.sheet;\n                var rules = [];\n                if (!styleSheet) {\n                    if (this.virtualStyleRulesMap.has(target)) {\n                        rules = this.virtualStyleRulesMap.get(target);\n                    }\n                    else {\n                        rules = [];\n                        this.virtualStyleRulesMap.set(target, rules);\n                    }\n                }\n                if (d.set) {\n                    if (styleSheet) {\n                        var rule = getNestedRule(styleSheet.rules, d.index);\n                        rule.style.setProperty(d.set.property, d.set.value, d.set.priority);\n                    }\n                    else {\n                        rules.push(__assign({ type: StyleRuleType.SetProperty, index: d.index }, d.set));\n                    }\n                }\n                if (d.remove) {\n                    if (styleSheet) {\n                        var rule = getNestedRule(styleSheet.rules, d.index);\n                        rule.style.removeProperty(d.remove.property);\n                    }\n                    else {\n                        rules.push(__assign({ type: StyleRuleType.RemoveProperty, index: d.index }, d.remove));\n                    }\n                }\n                break;\n            }\n            case IncrementalSource.CanvasMutation: {\n                if (!this.config.UNSAFE_replayCanvas) {\n                    return;\n                }\n                var target = this.mirror.getNode(d.id);\n                if (!target) {\n                    return this.debugNodeNotFound(d, d.id);\n                }\n                canvasMutation({\n                    event: e,\n                    mutation: d,\n                    target: target,\n                    imageMap: this.imageMap,\n                    errorHandler: this.warnCanvasMutationFailed.bind(this),\n                });\n                break;\n            }\n            case IncrementalSource.Font: {\n                try {\n                    var fontFace = new FontFace(d.family, d.buffer ? new Uint8Array(JSON.parse(d.fontSource)) : d.fontSource, d.descriptors);\n                    (_b = this.iframe.contentDocument) === null || _b === void 0 ? void 0 : _b.fonts.add(fontFace);\n                }\n                catch (error) {\n                    if (this.config.showWarning) {\n                        console.warn(error);\n                    }\n                }\n                break;\n            }\n        }\n    };\n    Replayer.prototype.applyMutation = function (d, useVirtualParent) {\n        var e_14, _a;\n        var _this = this;\n        d.removes.forEach(function (mutation) {\n            var target = _this.mirror.getNode(mutation.id);\n            if (!target) {\n                if (d.removes.find(function (r) { return r.id === mutation.parentId; })) {\n                    return;\n                }\n                return _this.warnNodeNotFound(d, mutation.id);\n            }\n            if (_this.virtualStyleRulesMap.has(target)) {\n                _this.virtualStyleRulesMap.delete(target);\n            }\n            var parent = _this.mirror.getNode(mutation.parentId);\n            if (!parent) {\n                return _this.warnNodeNotFound(d, mutation.parentId);\n            }\n            if (mutation.isShadow && hasShadowRoot(parent)) {\n                parent = parent.shadowRoot;\n            }\n            _this.mirror.removeNodeFromMap(target);\n            if (parent) {\n                var realTarget = null;\n                var realParent = '__sn' in parent ? _this.fragmentParentMap.get(parent) : undefined;\n                if (realParent && realParent.contains(target)) {\n                    parent = realParent;\n                }\n                else if (_this.fragmentParentMap.has(target)) {\n                    realTarget = _this.fragmentParentMap.get(target);\n                    _this.fragmentParentMap.delete(target);\n                    target = realTarget;\n                }\n                try {\n                    parent.removeChild(target);\n                }\n                catch (error) {\n                    if (error instanceof DOMException) {\n                        _this.warn('parent could not remove child in mutation', parent, realParent, target, realTarget, d);\n                    }\n                    else {\n                        throw error;\n                    }\n                }\n            }\n        });\n        var legacy_missingNodeMap = __assign({}, this.legacy_missingNodeRetryMap);\n        var queue = [];\n        var nextNotInDOM = function (mutation) {\n            var next = null;\n            if (mutation.nextId) {\n                next = _this.mirror.getNode(mutation.nextId);\n            }\n            if (mutation.nextId !== null &&\n                mutation.nextId !== undefined &&\n                mutation.nextId !== -1 &&\n                !next) {\n                return true;\n            }\n            return false;\n        };\n        var appendNode = function (mutation) {\n            var e_15, _a;\n            var _b, _c;\n            if (!_this.iframe.contentDocument) {\n                return console.warn('Looks like your replayer has been destroyed.');\n            }\n            var parent = _this.mirror.getNode(mutation.parentId);\n            if (!parent) {\n                if (mutation.node.type === NodeType.Document) {\n                    return _this.newDocumentQueue.push(mutation);\n                }\n                return queue.push(mutation);\n            }\n            var parentInDocument = null;\n            if (_this.iframe.contentDocument.contains) {\n                parentInDocument = _this.iframe.contentDocument.contains(parent);\n            }\n            else if (_this.iframe.contentDocument.body.contains) {\n                parentInDocument = _this.iframe.contentDocument.body.contains(parent);\n            }\n            var hasIframeChild = ((_c = (_b = parent).getElementsByTagName) === null || _c === void 0 ? void 0 : _c.call(_b, 'iframe').length) > 0;\n            if (useVirtualParent &&\n                parentInDocument &&\n                !isIframeINode(parent) &&\n                !hasIframeChild) {\n                var virtualParent = document.createDocumentFragment();\n                _this.mirror.map[mutation.parentId] = virtualParent;\n                _this.fragmentParentMap.set(virtualParent, parent);\n                _this.storeState(parent);\n                while (parent.firstChild) {\n                    virtualParent.appendChild(parent.firstChild);\n                }\n                parent = virtualParent;\n            }\n            if (mutation.node.isShadow) {\n                if (!hasShadowRoot(parent)) {\n                    parent.attachShadow({ mode: 'open' });\n                    parent = parent.shadowRoot;\n                }\n                else\n                    parent = parent.shadowRoot;\n            }\n            var previous = null;\n            var next = null;\n            if (mutation.previousId) {\n                previous = _this.mirror.getNode(mutation.previousId);\n            }\n            if (mutation.nextId) {\n                next = _this.mirror.getNode(mutation.nextId);\n            }\n            if (nextNotInDOM(mutation)) {\n                return queue.push(mutation);\n            }\n            if (mutation.node.rootId && !_this.mirror.getNode(mutation.node.rootId)) {\n                return;\n            }\n            var targetDoc = mutation.node.rootId\n                ? _this.mirror.getNode(mutation.node.rootId)\n                : _this.iframe.contentDocument;\n            if (isIframeINode(parent)) {\n                _this.attachDocumentToIframe(mutation, parent);\n                return;\n            }\n            var target = buildNodeWithSN(mutation.node, {\n                doc: targetDoc,\n                map: _this.mirror.map,\n                skipChild: true,\n                hackCss: true,\n                cache: _this.cache,\n            });\n            if (mutation.previousId === -1 || mutation.nextId === -1) {\n                legacy_missingNodeMap[mutation.node.id] = {\n                    node: target,\n                    mutation: mutation,\n                };\n                return;\n            }\n            if ('__sn' in parent &&\n                parent.__sn.type === NodeType.Element &&\n                parent.__sn.tagName === 'textarea' &&\n                mutation.node.type === NodeType.Text) {\n                try {\n                    for (var _d = __values(Array.from(parent.childNodes)), _e = _d.next(); !_e.done; _e = _d.next()) {\n                        var c = _e.value;\n                        if (c.nodeType === parent.TEXT_NODE) {\n                            parent.removeChild(c);\n                        }\n                    }\n                }\n                catch (e_15_1) { e_15 = { error: e_15_1 }; }\n                finally {\n                    try {\n                        if (_e && !_e.done && (_a = _d.return)) _a.call(_d);\n                    }\n                    finally { if (e_15) throw e_15.error; }\n                }\n            }\n            if (previous && previous.nextSibling && previous.nextSibling.parentNode) {\n                parent.insertBefore(target, previous.nextSibling);\n            }\n            else if (next && next.parentNode) {\n                parent.contains(next)\n                    ? parent.insertBefore(target, next)\n                    : parent.insertBefore(target, null);\n            }\n            else {\n                if (parent === targetDoc) {\n                    while (targetDoc.firstChild) {\n                        targetDoc.removeChild(targetDoc.firstChild);\n                    }\n                }\n                parent.appendChild(target);\n            }\n            if (isIframeINode(target)) {\n                var mutationInQueue_1 = _this.newDocumentQueue.find(function (m) { return m.parentId === target.__sn.id; });\n                if (mutationInQueue_1) {\n                    _this.attachDocumentToIframe(mutationInQueue_1, target);\n                    _this.newDocumentQueue = _this.newDocumentQueue.filter(function (m) { return m !== mutationInQueue_1; });\n                }\n            }\n            if (mutation.previousId || mutation.nextId) {\n                _this.legacy_resolveMissingNode(legacy_missingNodeMap, parent, target, mutation);\n            }\n        };\n        d.adds.forEach(function (mutation) {\n            appendNode(mutation);\n        });\n        var startTime = Date.now();\n        while (queue.length) {\n            var resolveTrees = queueToResolveTrees(queue);\n            queue.length = 0;\n            if (Date.now() - startTime > 500) {\n                this.warn('Timeout in the loop, please check the resolve tree data:', resolveTrees);\n                break;\n            }\n            try {\n                for (var resolveTrees_1 = (e_14 = void 0, __values(resolveTrees)), resolveTrees_1_1 = resolveTrees_1.next(); !resolveTrees_1_1.done; resolveTrees_1_1 = resolveTrees_1.next()) {\n                    var tree = resolveTrees_1_1.value;\n                    var parent_4 = this.mirror.getNode(tree.value.parentId);\n                    if (!parent_4) {\n                        this.debug('Drop resolve tree since there is no parent for the root node.', tree);\n                    }\n                    else {\n                        iterateResolveTree(tree, function (mutation) {\n                            appendNode(mutation);\n                        });\n                    }\n                }\n            }\n            catch (e_14_1) { e_14 = { error: e_14_1 }; }\n            finally {\n                try {\n                    if (resolveTrees_1_1 && !resolveTrees_1_1.done && (_a = resolveTrees_1.return)) _a.call(resolveTrees_1);\n                }\n                finally { if (e_14) throw e_14.error; }\n            }\n        }\n        if (Object.keys(legacy_missingNodeMap).length) {\n            Object.assign(this.legacy_missingNodeRetryMap, legacy_missingNodeMap);\n        }\n        d.texts.forEach(function (mutation) {\n            var target = _this.mirror.getNode(mutation.id);\n            if (!target) {\n                if (d.removes.find(function (r) { return r.id === mutation.id; })) {\n                    return;\n                }\n                return _this.warnNodeNotFound(d, mutation.id);\n            }\n            if (_this.fragmentParentMap.has(target)) {\n                target = _this.fragmentParentMap.get(target);\n            }\n            target.textContent = mutation.value;\n        });\n        d.attributes.forEach(function (mutation) {\n            var target = _this.mirror.getNode(mutation.id);\n            if (!target) {\n                if (d.removes.find(function (r) { return r.id === mutation.id; })) {\n                    return;\n                }\n                return _this.warnNodeNotFound(d, mutation.id);\n            }\n            if (_this.fragmentParentMap.has(target)) {\n                target = _this.fragmentParentMap.get(target);\n            }\n            for (var attributeName in mutation.attributes) {\n                if (typeof attributeName === 'string') {\n                    var value = mutation.attributes[attributeName];\n                    if (value === null) {\n                        target.removeAttribute(attributeName);\n                    }\n                    else if (typeof value === 'string') {\n                        try {\n                            target.setAttribute(attributeName, value);\n                        }\n                        catch (error) {\n                            if (_this.config.showWarning) {\n                                console.warn('An error occurred may due to the checkout feature.', error);\n                            }\n                        }\n                    }\n                    else if (attributeName === 'style') {\n                        var styleValues = value;\n                        var targetEl = target;\n                        for (var s in styleValues) {\n                            if (styleValues[s] === false) {\n                                targetEl.style.removeProperty(s);\n                            }\n                            else if (styleValues[s] instanceof Array) {\n                                var svp = styleValues[s];\n                                targetEl.style.setProperty(s, svp[0], svp[1]);\n                            }\n                            else {\n                                var svs = styleValues[s];\n                                targetEl.style.setProperty(s, svs);\n                            }\n                        }\n                    }\n                }\n            }\n        });\n    };\n    Replayer.prototype.applyScroll = function (d, isSync) {\n        var target = this.mirror.getNode(d.id);\n        if (!target) {\n            return this.debugNodeNotFound(d, d.id);\n        }\n        if (target === this.iframe.contentDocument) {\n            this.iframe.contentWindow.scrollTo({\n                top: d.y,\n                left: d.x,\n                behavior: isSync ? 'auto' : 'smooth',\n            });\n        }\n        else if (target.__sn.type === NodeType.Document) {\n            target.defaultView.scrollTo({\n                top: d.y,\n                left: d.x,\n                behavior: isSync ? 'auto' : 'smooth',\n            });\n        }\n        else {\n            try {\n                target.scrollTop = d.y;\n                target.scrollLeft = d.x;\n            }\n            catch (error) {\n            }\n        }\n    };\n    Replayer.prototype.applyInput = function (d) {\n        var target = this.mirror.getNode(d.id);\n        if (!target) {\n            return this.debugNodeNotFound(d, d.id);\n        }\n        try {\n            target.checked = d.isChecked;\n            target.value = d.text;\n        }\n        catch (error) {\n        }\n    };\n    Replayer.prototype.applyText = function (d, mutation) {\n        var target = this.mirror.getNode(d.id);\n        if (!target) {\n            return this.debugNodeNotFound(mutation, d.id);\n        }\n        try {\n            target.textContent = d.value;\n        }\n        catch (error) {\n        }\n    };\n    Replayer.prototype.legacy_resolveMissingNode = function (map, parent, target, targetMutation) {\n        var previousId = targetMutation.previousId, nextId = targetMutation.nextId;\n        var previousInMap = previousId && map[previousId];\n        var nextInMap = nextId && map[nextId];\n        if (previousInMap) {\n            var _a = previousInMap, node = _a.node, mutation = _a.mutation;\n            parent.insertBefore(node, target);\n            delete map[mutation.node.id];\n            delete this.legacy_missingNodeRetryMap[mutation.node.id];\n            if (mutation.previousId || mutation.nextId) {\n                this.legacy_resolveMissingNode(map, parent, node, mutation);\n            }\n        }\n        if (nextInMap) {\n            var _b = nextInMap, node = _b.node, mutation = _b.mutation;\n            parent.insertBefore(node, target.nextSibling);\n            delete map[mutation.node.id];\n            delete this.legacy_missingNodeRetryMap[mutation.node.id];\n            if (mutation.previousId || mutation.nextId) {\n                this.legacy_resolveMissingNode(map, parent, node, mutation);\n            }\n        }\n    };\n    Replayer.prototype.moveAndHover = function (x, y, id, isSync, debugData) {\n        var target = this.mirror.getNode(id);\n        if (!target) {\n            return this.debugNodeNotFound(debugData, id);\n        }\n        var base = getBaseDimension(target, this.iframe);\n        var _x = x * base.absoluteScale + base.x;\n        var _y = y * base.absoluteScale + base.y;\n        this.mouse.style.left = \"\".concat(_x, \"px\");\n        this.mouse.style.top = \"\".concat(_y, \"px\");\n        if (!isSync) {\n            this.drawMouseTail({ x: _x, y: _y });\n        }\n        this.hoverElements(target);\n    };\n    Replayer.prototype.drawMouseTail = function (position) {\n        var _this = this;\n        if (!this.mouseTail) {\n            return;\n        }\n        var _a = this.config.mouseTail === true\n            ? defaultMouseTailConfig\n            : Object.assign({}, defaultMouseTailConfig, this.config.mouseTail), lineCap = _a.lineCap, lineWidth = _a.lineWidth, strokeStyle = _a.strokeStyle, duration = _a.duration;\n        var draw = function () {\n            if (!_this.mouseTail) {\n                return;\n            }\n            var ctx = _this.mouseTail.getContext('2d');\n            if (!ctx || !_this.tailPositions.length) {\n                return;\n            }\n            ctx.clearRect(0, 0, _this.mouseTail.width, _this.mouseTail.height);\n            ctx.beginPath();\n            ctx.lineWidth = lineWidth;\n            ctx.lineCap = lineCap;\n            ctx.strokeStyle = strokeStyle;\n            ctx.moveTo(_this.tailPositions[0].x, _this.tailPositions[0].y);\n            _this.tailPositions.forEach(function (p) { return ctx.lineTo(p.x, p.y); });\n            ctx.stroke();\n        };\n        this.tailPositions.push(position);\n        draw();\n        setTimeout(function () {\n            _this.tailPositions = _this.tailPositions.filter(function (p) { return p !== position; });\n            draw();\n        }, duration / this.speedService.state.context.timer.speed);\n    };\n    Replayer.prototype.hoverElements = function (el) {\n        var _a;\n        (_a = this.iframe.contentDocument) === null || _a === void 0 ? void 0 : _a.querySelectorAll('.\\\\:hover').forEach(function (hoveredEl) {\n            hoveredEl.classList.remove(':hover');\n        });\n        var currentEl = el;\n        while (currentEl) {\n            if (currentEl.classList) {\n                currentEl.classList.add(':hover');\n            }\n            currentEl = currentEl.parentElement;\n        }\n    };\n    Replayer.prototype.isUserInteraction = function (event) {\n        if (event.type !== EventType.IncrementalSnapshot) {\n            return false;\n        }\n        return (event.data.source > IncrementalSource.Mutation &&\n            event.data.source <= IncrementalSource.Input);\n    };\n    Replayer.prototype.backToNormal = function () {\n        this.nextUserInteractionEvent = null;\n        if (this.speedService.state.matches('normal')) {\n            return;\n        }\n        this.speedService.send({ type: 'BACK_TO_NORMAL' });\n        this.emitter.emit(ReplayerEvents.SkipEnd, {\n            speed: this.speedService.state.context.normalSpeed,\n        });\n    };\n    Replayer.prototype.restoreRealParent = function (frag, parent) {\n        this.mirror.map[parent.__sn.id] = parent;\n        if (parent.__sn.type === NodeType.Element &&\n            parent.__sn.tagName === 'textarea' &&\n            frag.textContent) {\n            parent.value = frag.textContent;\n        }\n        parent.appendChild(frag);\n        this.restoreState(parent);\n    };\n    Replayer.prototype.storeState = function (parent) {\n        var e_16, _a;\n        if (parent) {\n            if (parent.nodeType === parent.ELEMENT_NODE) {\n                var parentElement = parent;\n                if (parentElement.scrollLeft || parentElement.scrollTop) {\n                    this.elementStateMap.set(parent, {\n                        scroll: [parentElement.scrollLeft, parentElement.scrollTop],\n                    });\n                }\n                if (parentElement.tagName === 'STYLE')\n                    storeCSSRules(parentElement, this.virtualStyleRulesMap);\n                var children = parentElement.children;\n                try {\n                    for (var _b = __values(Array.from(children)), _c = _b.next(); !_c.done; _c = _b.next()) {\n                        var child = _c.value;\n                        this.storeState(child);\n                    }\n                }\n                catch (e_16_1) { e_16 = { error: e_16_1 }; }\n                finally {\n                    try {\n                        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n                    }\n                    finally { if (e_16) throw e_16.error; }\n                }\n            }\n        }\n    };\n    Replayer.prototype.restoreState = function (parent) {\n        var e_17, _a;\n        if (parent.nodeType === parent.ELEMENT_NODE) {\n            var parentElement = parent;\n            if (this.elementStateMap.has(parent)) {\n                var storedState = this.elementStateMap.get(parent);\n                if (storedState.scroll) {\n                    parentElement.scrollLeft = storedState.scroll[0];\n                    parentElement.scrollTop = storedState.scroll[1];\n                }\n                this.elementStateMap.delete(parent);\n            }\n            var children = parentElement.children;\n            try {\n                for (var _b = __values(Array.from(children)), _c = _b.next(); !_c.done; _c = _b.next()) {\n                    var child = _c.value;\n                    this.restoreState(child);\n                }\n            }\n            catch (e_17_1) { e_17 = { error: e_17_1 }; }\n            finally {\n                try {\n                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n                }\n                finally { if (e_17) throw e_17.error; }\n            }\n        }\n    };\n    Replayer.prototype.restoreNodeSheet = function (node) {\n        var storedRules = this.virtualStyleRulesMap.get(node);\n        if (node.nodeName !== 'STYLE') {\n            return;\n        }\n        if (!storedRules) {\n            return;\n        }\n        var styleNode = node;\n        applyVirtualStyleRulesToNode(storedRules, styleNode);\n    };\n    Replayer.prototype.warnNodeNotFound = function (d, id) {\n        if (this.treeIndex.idRemoved(id)) {\n            this.warn(\"Node with id '\".concat(id, \"' was previously removed. \"), d);\n        }\n        else {\n            this.warn(\"Node with id '\".concat(id, \"' not found. \"), d);\n        }\n    };\n    Replayer.prototype.warnCanvasMutationFailed = function (d, error) {\n        this.warn(\"Has error on canvas update\", error, 'canvas mutation:', d);\n    };\n    Replayer.prototype.debugNodeNotFound = function (d, id) {\n        if (this.treeIndex.idRemoved(id)) {\n            this.debug(REPLAY_CONSOLE_PREFIX, \"Node with id '\".concat(id, \"' was previously removed. \"), d);\n        }\n        else {\n            this.debug(REPLAY_CONSOLE_PREFIX, \"Node with id '\".concat(id, \"' not found. \"), d);\n        }\n    };\n    Replayer.prototype.warn = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        if (!this.config.showWarning) {\n            return;\n        }\n        console.warn.apply(console, __spreadArray([REPLAY_CONSOLE_PREFIX], __read(args), false));\n    };\n    Replayer.prototype.debug = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        if (!this.config.showDebug) {\n            return;\n        }\n        console.log.apply(console, __spreadArray([REPLAY_CONSOLE_PREFIX], __read(args), false));\n    };\n    return Replayer;\n}());\n\nexport { Replayer };\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}